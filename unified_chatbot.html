<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîß „Ç≠„É£„É≥„Éî„É≥„Ç∞„Ç´„Éº‰øÆÁêÜ„ÉÅ„É£„ÉÉ„Éà„Éú„ÉÉ„Éà</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .hidden {
            display: none !important;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        .header h1 {
            color: #667eea;
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        .header p {
            color: #666;
            font-size: 1.2rem;
            margin-bottom: 20px;
        }

        .status-bar {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
        }

        .status-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }

        .status-online { background-color: #28a745; }
        .status-offline { background-color: #dc3545; }
        .status-warning { background-color: #ffc107; }

        .chat-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            min-height: 500px;
        }

        .chat-messages {
            max-height: 400px;
            overflow-y: auto;
            margin-bottom: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 15px;
            border: 2px solid #e9ecef;
        }

        .message {
            margin: 15px 0;
            padding: 15px 20px;
            border-radius: 20px;
            max-width: 80%;
            word-wrap: break-word;
            animation: fadeIn 0.3s ease-in;
        }

        .message-user {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            margin-left: auto;
            border-radius: 20px 20px 5px 20px;
        }

        .message-ai {
            background: white;
            color: #333;
            border: 2px solid #e9ecef;
            border-radius: 20px 20px 20px 5px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .message-system {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
            border-radius: 10px;
            text-align: center;
            font-style: italic;
        }

        .input-container {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        .chat-input {
            flex: 1;
            padding: 15px 20px;
            border: 2px solid #667eea;
            border-radius: 25px;
            font-size: 1rem;
            outline: none;
            transition: all 0.3s ease;
        }

        .chat-input:focus {
            border-color: #764ba2;
            box-shadow: 0 0 15px rgba(102, 126, 234, 0.3);
        }

        .send-btn {
            padding: 15px 30px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .send-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .send-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .mode-selector {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .mode-btn {
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid transparent;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .mode-btn.active {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border-color: #667eea;
        }

        .mode-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .loading {
            display: none;
            text-align: center;
            color: #667eea;
            font-style: italic;
        }

        .loading.show {
            display: block;
        }

        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(100%); }
            to { opacity: 1; transform: translateX(0); }
        }

        @keyframes slideOut {
            from { opacity: 1; transform: translateX(0); }
            to { opacity: 0; transform: translateX(100%); }
        }

        .debug-panel {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            display: none;
        }

        .debug-panel.show {
            display: block;
        }

        .debug-title {
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
        }

        .debug-content {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 5px;
            padding: 10px;
            font-family: monospace;
            font-size: 0.9rem;
            max-height: 200px;
            overflow-y: auto;
        }

        /* Ë®∫Êñ≠„Éï„É≠„ÉºÂ∞ÇÁî®„Çπ„Çø„Ç§„É´ */
        .diagnostic-flow-container {
            background: linear-gradient(135deg, #e8f5e8 0%, #f0f8ff 100%);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            border-left: 5px solid #28a745;
            display: none;
        }

        .diagnostic-flow-container.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .diagnostic-progress {
            margin-bottom: 20px;
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .progress-text {
            font-weight: bold;
            color: #28a745;
        }

        .progress-bar {
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #28a745, #20c997);
            border-radius: 4px;
            transition: width 0.5s ease;
            width: 0%;
        }

        .diagnostic-question {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .diagnostic-question h3 {
            color: #28a745;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        .diagnostic-question p {
            color: #333;
            font-size: 1.1rem;
            line-height: 1.6;
            margin: 0;
        }

        .diagnostic-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .option-btn {
            padding: 15px 20px;
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
            font-size: 1rem;
            color: #333;
        }

        .option-btn:hover {
            border-color: #28a745;
            background: #f8fff8;
            transform: translateX(5px);
        }

        .option-btn.selected {
            border-color: #28a745;
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
        }

        .diagnostic-result {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-top: 20px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
            display: none;
        }

        .diagnostic-result.active {
            display: block;
            animation: slideIn 0.5s ease;
        }

        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e0e0e0;
        }

        .result-header h3 {
            color: #28a745;
            margin: 0;
            font-size: 1.4rem;
        }

        .confidence-meter {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .confidence-value {
            background: linear-gradient(45deg, #28a745, #20c997);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9rem;
        }

        .related-cases, .required-parts {
            margin-bottom: 25px;
        }

        .related-cases h4, .required-parts h4 {
            color: #495057;
            margin-bottom: 15px;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .case-item, .part-item {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 12px;
            border-left: 4px solid #28a745;
        }

        .case-title, .part-name {
            font-weight: bold;
            color: #495057;
            margin-bottom: 8px;
        }

        .case-description, .part-info {
            color: #6c757d;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .case-url, .part-price {
            margin-top: 8px;
            font-size: 0.8rem;
        }

        .case-url a {
            color: #28a745;
            text-decoration: none;
        }

        .case-url a:hover {
            text-decoration: underline;
        }

        .emergency-warning {
            background: linear-gradient(135deg, #dc3545, #e74c3c);
            color: white;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
            border-left: 5px solid #c82333;
        }

        .emergency-warning h4 {
            margin: 0 0 10px 0;
            font-size: 1.1rem;
        }

        .emergency-warning p {
            margin: 0;
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .quick-actions {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .quick-btn {
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid #667eea;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .quick-btn:hover {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
        }

        .new-conversation-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            margin: 20px 0;
        }

        .new-conversation-btn {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
        }

        .new-conversation-btn:hover {
            background: linear-gradient(135deg, #218838, #1ea085);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4);
        }

        .conversation-info {
            font-size: 0.9rem;
            color: #666;
            font-style: italic;
        }

        /* „É™„É≥„ÇØ„ÅÆ„Çπ„Çø„Ç§„É´ */
        .message a {
            color: #667eea;
            text-decoration: underline;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .message a:hover {
            color: #5a6fd8;
            text-decoration: none;
            background-color: rgba(102, 126, 234, 0.1);
            padding: 2px 4px;
            border-radius: 4px;
        }

        .blog-link-item {
            transition: all 0.3s ease;
        }

        .blog-link-item:hover {
            background-color: #e9ecef !important;
            transform: translateX(5px);
        }

        .blog-link-item a:hover {
            color: #5a6fd8 !important;
            text-decoration: underline !important;
        }

        .footer {
            text-align: center;
            color: rgba(255, 255, 255, 0.8);
            margin-top: 30px;
        }

        /* Èñ¢ÈÄ£„Éñ„É≠„Ç∞„É™„É≥„ÇØ„ÅÆ„Çπ„Çø„Ç§„É´ */
        .blog-link {
            color: #667eea;
            text-decoration: none;
            padding: 8px 12px;
            background: white;
            border-radius: 8px;
            border: 1px solid #e9ecef;
            transition: all 0.3s ease;
            display: block;
            margin-bottom: 8px;
        }

        .blog-link:hover {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- „Éò„ÉÉ„ÉÄ„Éº -->
        <div class="header">
            <h1>üîß „Ç≠„É£„É≥„Éî„É≥„Ç∞„Ç´„Éº‰øÆÁêÜ„ÉÅ„É£„ÉÉ„Éà„Éú„ÉÉ„Éà</h1>
            <p class="hidden">AIË®∫Êñ≠ + RAGÊ§úÁ¥¢ + „É™„Ç¢„É´„Çø„Ç§„É†ÊÉÖÂ†± + Â∞ÇÈñÄÁü•Ë≠ò = ‰øÆÁêÜÊîØÊè¥</p>
            
            <!-- Êñ∞„Åó„ÅÑ‰ºöË©±ÈñãÂßã„Éú„Çø„É≥ -->
            <div class="new-conversation-section hidden">
                <button class="new-conversation-btn" onclick="startNewConversation()">
                    üÜï Êñ∞„Åó„ÅÑ‰ºöË©±„ÇíÈñãÂßã
                </button>
                <span class="conversation-info">Êñ∞„Åó„ÅÑ„Çª„ÉÉ„Ç∑„Éß„É≥„ÅßAPI„Ç≠„Éº„ÇíÊõ¥Êñ∞</span>
            </div>
            
            <!-- „Çπ„ÉÜ„Éº„Çø„Çπ„Éê„Éº -->
            <div class="status-bar hidden">
                <div class="status-item">
                    <div class="status-indicator status-offline" id="apiStatus"></div>
                    <span>Áµ±ÂêàAPI</span>
                </div>
                <div class="status-item">
                    <div class="status-indicator status-offline" id="aiStatus"></div>
                    <span>AI „Ç®„É≥„Ç∏„É≥</span>
                </div>
                <div class="status-item">
                    <div class="status-indicator status-offline" id="ragStatus"></div>
                    <span>RAG „Ç∑„Çπ„ÉÜ„É†</span>
                </div>
            </div>
        </div>

        <!-- „ÉÅ„É£„ÉÉ„Éà„Ç≥„É≥„ÉÜ„Éä -->
        <div class="chat-container">
            <!-- „É¢„Éº„ÉâÈÅ∏Êäû -->
            <div class="mode-selector">
                <button class="mode-btn active" data-mode="chat">ü§ñ Áµ±Âêà„ÉÅ„É£„ÉÉ„Éà</button>
                <button class="mode-btn" data-mode="diagnostic">üîç ÁóáÁä∂Ë®∫Êñ≠</button>
                <button class="mode-btn hidden" data-mode="repair_search">üõ†Ô∏è ‰øÆÁêÜÊ§úÁ¥¢</button>
                <button class="mode-btn" data-mode="cost_estimate">üîß ‰øÆÁêÜ„Ç¢„Éâ„Éê„Ç§„Çπ„Çª„É≥„Çø„Éº</button>
            </div>

            <!-- „ÇØ„Ç§„ÉÉ„ÇØ„Ç¢„ÇØ„Ç∑„Éß„É≥ -->
            <div class="quick-actions">
                <button class="quick-btn" onclick="sendQuickMessage('„Éê„ÉÉ„ÉÜ„É™„Éº„Åå‰∏ä„Åå„Çä„Åæ„Åõ„Çì')">„Éê„ÉÉ„ÉÜ„É™„Éº‰∏ä„Åå„Çä</button>
                <button class="quick-btn" onclick="sendQuickMessage('„Éà„Ç§„É¨„ÅåË©∞„Åæ„Çä„Åæ„Åó„Åü')">„Éà„Ç§„É¨Ë©∞„Åæ„Çä</button>
                <button class="quick-btn" onclick="sendQuickMessage('„Ç®„Ç¢„Ç≥„É≥„ÅåÂäπ„Åç„Åæ„Åõ„Çì')">„Ç®„Ç¢„Ç≥„É≥ÊïÖÈöú</button>
                <button class="quick-btn" onclick="sendQuickMessage('Èõ®Êºè„Çä„Åå„Åó„Åæ„Åô')">Èõ®Êºè„Çä</button>
                <button class="quick-btn" onclick="sendQuickMessage('‰øÆÁêÜË≤ªÁî®„ÇíÁü•„Çä„Åü„ÅÑ')">Ë≤ªÁî®Áõ∏Ë´á</button>
            </div>

            <!-- „ÉÅ„É£„ÉÉ„Éà„É°„ÉÉ„Çª„Éº„Ç∏ -->
            <div class="chat-messages" id="chatMessages">
                <div class="message message-system">
                    üîß „Ç≠„É£„É≥„Éî„É≥„Ç∞„Ç´„Éº‰øÆÁêÜ„ÉÅ„É£„ÉÉ„Éà„Éú„ÉÉ„Éà„Å´„Çà„ÅÜ„Åì„ÅùÔºÅ<br>
                    ‰øÆÁêÜ„Å´„Å§„ÅÑ„Å¶‰Ωï„Åß„ÇÇ„ÅäËÅû„Åç„Åè„Å†„Åï„ÅÑ„ÄÇAIË®∫Êñ≠„ÄÅË©≥Á¥∞Ê§úÁ¥¢„ÄÅË≤ªÁî®Áõ∏Ë´á„Å™„Å©„ÄÅ„ÅÇ„Çâ„ÇÜ„ÇãÊ©üËÉΩ„ÇíÁµ±Âêà„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ
                </div>
                
                <!-- Èñ¢ÈÄ£„Éñ„É≠„Ç∞„Çª„ÇØ„Ç∑„Éß„É≥ -->
                <div class="message message-system" style="background: #f8f9fa; border-left: 4px solid #667eea; margin: 20px 0;">
                    <h3 style="color: #667eea; margin-bottom: 15px;">üìö Èñ¢ÈÄ£„Éñ„É≠„Ç∞</h3>
                    <p style="margin-bottom: 15px; color: #666;">„Çà„ÇäË©≥„Åó„ÅÑÊÉÖÂ†±„ÅØ‰øÆÁêÜ„Éñ„É≠„Ç∞‰∏ÄË¶ß„Çí„ÅîË¶ß„Åè„Å†„Åï„ÅÑ„ÄÇ</p>
                    <div style="display: flex; flex-direction: column; gap: 10px;">
                        <a href="https://camper-repair.net/blog/repair1/" target="_blank" class="blog-link">
                            üîã „Éê„ÉÉ„ÉÜ„É™„Éº„Éª„Éê„ÉÉ„ÉÜ„É™„Éº„ÅÆÊïÖÈöú„Å®‰øÆÁêÜÊñπÊ≥ï
                        </a>
                        <a href="https://camper-repair.net/blog/risk1/" target="_blank" class="blog-link">
                            üõ†Ô∏è Âü∫Êú¨‰øÆÁêÜ„Éª„Ç≠„É£„É≥„Éî„É≥„Ç∞„Ç´„Éº‰øÆÁêÜ„ÅÆÂü∫Êú¨
                        </a>
                        <a href="https://camper-repair.net/battery-selection/" target="_blank" class="blog-link">
                            üîç ÂÆöÊúüÁÇπÊ§ú„ÉªÂÆöÊúüÁÇπÊ§ú„Å®„É°„É≥„ÉÜ„Éä„É≥„Çπ
                        </a>
                    </div>
                </div>
            </div>

            <!-- Ë®∫Êñ≠„Éï„É≠„Éº„Ç≥„É≥„ÉÜ„Éä -->
            <div class="diagnostic-flow-container" id="diagnosticFlowContainer">
                <!-- Ë®∫Êñ≠ÈÄ≤Ë°åÁä∂Ê≥Å -->
                <div class="diagnostic-progress">
                    <div class="progress-header">
                        <span class="progress-text" id="progressText">Ë®∫Êñ≠„ÇíÈñãÂßã„Åó„Å¶„ÅÑ„Åæ„Åô...</span>
                        <span id="progressStep">1/5</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                </div>

                <!-- Á∑äÊÄ•Ë≠¶Âëä -->
                <div class="emergency-warning hidden" id="emergencyWarning">
                    <h4>üö® Á∑äÊÄ•Ë≠¶Âëä</h4>
                    <p id="emergencyText">Âç±Èô∫„Å™ÁóáÁä∂„ÅåÊ§úÂá∫„Åï„Çå„Åæ„Åó„Åü„ÄÇÁõ¥„Å°„Å´ÂÆâÂÖ®ÂØæÁ≠ñ„ÇíË¨õ„Åò„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ</p>
                </div>

                <!-- Ë®∫Êñ≠Ë≥™Âïè -->
                <div class="diagnostic-question">
                    <h3>üîç Ë®∫Êñ≠Ë≥™Âïè</h3>
                    <p id="currentQuestion">ÁóáÁä∂„ÇíË©≥„Åó„ÅèÊïô„Åà„Å¶„Åè„Å†„Åï„ÅÑ</p>
                </div>

                <!-- ÈÅ∏ÊäûËÇ¢ -->
                <div class="diagnostic-options" id="diagnosticOptions">
                    <!-- ÈÅ∏ÊäûËÇ¢„ÅåÂãïÁöÑ„Å´ÁîüÊàê„Åï„Çå„Çã -->
                </div>

                <!-- Ë®∫Êñ≠ÁµêÊûú -->
                <div class="diagnostic-result" id="diagnosticResult">
                    <div class="result-header">
                        <h3>üîç Ë®∫Êñ≠ÁµêÊûú</h3>
                        <div class="confidence-meter">
                            <span class="confidence-value" id="confidenceValue">85%</span>
                        </div>
                    </div>

                    <div class="result-content" id="resultContent">
                        <!-- Ë®∫Êñ≠ÁµêÊûú„ÅÆÂÜÖÂÆπ -->
                    </div>

                    <div class="related-cases">
                        <h4>üîß Èñ¢ÈÄ£‰øÆÁêÜ„Ç±„Éº„Çπ</h4>
                        <div id="relatedCasesContent">
                            <!-- Notion„Éá„Éº„Çø„Éô„Éº„Çπ„Åã„Çâ„ÅÆ„Ç±„Éº„ÇπË°®Á§∫ -->
                        </div>
                    </div>

                    <div class="required-parts">
                        <h4>üõ†Ô∏è ÂøÖË¶Å„Å™ÈÉ®ÂìÅ„ÉªÂ∑•ÂÖ∑</h4>
                        <div id="requiredPartsContent">
                            <!-- ÈÉ®ÂìÅÊÉÖÂ†±Ë°®Á§∫ -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- „É≠„Éº„Éá„Ç£„É≥„Ç∞ -->
            <div class="loading" id="loading">
                <div class="spinner"></div>
                AI„ÅåÂõûÁ≠î„ÇíÁîüÊàê‰∏≠...
            </div>

            <!-- ÂÖ•Âäõ„Éï„Ç©„Éº„É† -->
            <div class="input-container">
                <input type="text" class="chat-input" id="chatInput" placeholder="‰øÆÁêÜ„Å´„Å§„ÅÑ„Å¶Ë≥™Âïè„Åó„Å¶„Åè„Å†„Åï„ÅÑ..." onkeypress="handleKeyPress(event)">
                <button class="send-btn" id="sendBtn" onclick="sendMessage()">ÈÄÅ‰ø°</button>
            </div>

            <!-- „Éá„Éê„ÉÉ„Ç∞„Éë„Éç„É´ -->
            <div class="debug-panel" id="debugPanel">
                <div class="debug-title">üîç „Éá„Éê„ÉÉ„Ç∞ÊÉÖÂ†±</div>
                <div class="debug-content" id="debugContent"></div>
            </div>
        </div>

        <!-- „Éï„ÉÉ„Çø„Éº -->
        <div class="footer">
            <p>¬© 2024 „Ç≠„É£„É≥„Éî„É≥„Ç∞„Ç´„Éº‰øÆÁêÜ„ÉÅ„É£„ÉÉ„Éà„Éú„ÉÉ„Éà - Áµ±ÂêàAI„Ç∑„Çπ„ÉÜ„É†</p>
        </div>
    </div>

    <script>
        // „Ç∞„É≠„Éº„Éê„É´Â§âÊï∞
        let currentMode = 'chat';
        let isProcessing = false;
        let debugMode = false;
        
        // Ë®∫Êñ≠„Éï„É≠„ÉºÁî®Â§âÊï∞
        let diagnosticSession = null;
        let diagnosticFlow = null;
        let currentDiagnosticNode = null;
        let diagnosticHistory = [];
        let conversationId = null;

        // ÂàùÊúüÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            checkSystemStatus();
            setupEventListeners();
            startNewConversation();
            
            // „Éá„Éï„Ç©„É´„Éà„É¢„Éº„Éâ„ÇíË®≠ÂÆö
            setMode('chat');
            console.log('ÂàùÊúüÂåñÂÆå‰∫Ü„ÄÅ„Éá„Éï„Ç©„É´„Éà„É¢„Éº„Éâ: chat');
        });

        // Êñ∞„Åó„ÅÑ‰ºöË©±ÈñãÂßã
        async function startNewConversation() {
            try {
                // „Åæ„Åö‰ºöË©±„ÇíÈñãÂßã
                const response = await fetch('http://localhost:5002/start_conversation', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    conversationId = data.conversation_id;
                    console.log('Êñ∞„Åó„ÅÑ‰ºöË©±„ÇíÈñãÂßã„Åó„Åæ„Åó„Åü:', conversationId);
                    
                    // „ÉÅ„É£„ÉÉ„Éà„É°„ÉÉ„Çª„Éº„Ç∏„Çí„ÇØ„É™„Ç¢
                    const chatMessages = document.getElementById('chatMessages');
                    if (chatMessages) {
                        chatMessages.innerHTML = '';
                        addMessage('üÜï Êñ∞„Åó„ÅÑ‰ºöË©±„ÇíÈñãÂßã„Åó„Åæ„Åó„Åü„ÄÇ‰Ωï„Åß„ÇÇ„ÅäËÅû„Åç„Åè„Å†„Åï„ÅÑÔºÅ', 'ai');
                    }
                    
                    // ÊàêÂäü„É°„ÉÉ„Çª„Éº„Ç∏„ÇíË°®Á§∫
                    showNotification('Êñ∞„Åó„ÅÑ‰ºöË©±„ÇíÈñãÂßã„Åó„Åæ„Åó„Åü„ÄÇAPI„Ç≠„Éº„ÅåÊõ¥Êñ∞„Åï„Çå„Åæ„Åó„Åü„ÄÇ', 'success');
                    
                    // „ÉÜ„Çπ„Éà„É°„ÉÉ„Çª„Éº„Ç∏„ÇíÈÄÅ‰ø°„Åó„Å¶API„Ç≠„Éº„ÇíÁ¢∫Ë™ç
                    await testApiKey();
                } else {
                    console.error('Êñ∞„Åó„ÅÑ‰ºöË©±ÈñãÂßã„Ç®„É©„Éº:', response.status);
                    showNotification('Êñ∞„Åó„ÅÑ‰ºöË©±„ÅÆÈñãÂßã„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ', 'error');
                }
            } catch (error) {
                console.error('Êñ∞„Åó„ÅÑ‰ºöË©±ÈñãÂßã„Ç®„É©„Éº:', error);
                showNotification('Êñ∞„Åó„ÅÑ‰ºöË©±„ÅÆÈñãÂßã‰∏≠„Å´„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü„ÄÇ', 'error');
            }
        }

        // API„Ç≠„Éº„ÉÜ„Çπ„Éà
        async function testApiKey() {
            try {
                const testResponse = await fetch('http://localhost:5002/ask', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: new URLSearchParams({
                        question: 'API„Ç≠„Éº„ÅÆ„ÉÜ„Çπ„Éà'
                    })
                });
                
                if (testResponse.ok) {
                    console.log('API„Ç≠„Éº„ÉÜ„Çπ„ÉàÊàêÂäü');
                    showNotification('API„Ç≠„Éº„ÅåÊ≠£Â∏∏„Å´Âãï‰Ωú„Åó„Å¶„ÅÑ„Åæ„ÅôÔºÅ', 'success');
                } else {
                    const errorData = await testResponse.json();
                    console.error('API„Ç≠„Éº„ÉÜ„Çπ„Éà„Ç®„É©„Éº:', errorData);
                    showNotification('API„Ç≠„Éº„Å´ÂïèÈ°å„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇÁÆ°ÁêÜËÄÖ„Å´„ÅäÂïè„ÅÑÂêà„Çè„Åõ„Åè„Å†„Åï„ÅÑ„ÄÇ', 'error');
                }
            } catch (error) {
                console.error('API„Ç≠„Éº„ÉÜ„Çπ„Éà„Ç®„É©„Éº:', error);
                showNotification('API„Ç≠„Éº„ÉÜ„Çπ„Éà‰∏≠„Å´„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü„ÄÇ', 'error');
            }
        }

        // ÈÄöÁü•Ë°®Á§∫ÔºàÈùûË°®Á§∫ÂåñÔºâ
        function showNotification(message, type = 'info') {
            // ÈÄöÁü•„ÇíÈùûË°®Á§∫„Å´„Åô„Çã„Åü„ÇÅ„ÄÅ‰Ωï„ÇÇ„Åó„Å™„ÅÑ
            return;
        }

        // „Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº„ÅÆË®≠ÂÆö
        function setupEventListeners() {
            // „É¢„Éº„Éâ„Éú„Çø„É≥„ÅÆ„Ç§„Éô„É≥„Éà
            document.querySelectorAll('.mode-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    console.log('„É¢„Éº„Éâ„Éú„Çø„É≥„Åå„ÇØ„É™„ÉÉ„ÇØ„Åï„Çå„Åæ„Åó„Åü:', this.dataset.mode);
                    setMode(this.dataset.mode);
                });
            });
            
            // „Éá„Éê„ÉÉ„Ç∞Áî®: „É¢„Éº„Éâ„Éú„Çø„É≥„ÅÆÁä∂ÊÖã„ÇíÁ¢∫Ë™ç
            console.log('„É¢„Éº„Éâ„Éú„Çø„É≥„ÅÆÊï∞:', document.querySelectorAll('.mode-btn').length);
            document.querySelectorAll('.mode-btn').forEach((btn, index) => {
                console.log(`„Éú„Çø„É≥ ${index}:`, btn.textContent, 'data-mode:', btn.dataset.mode);
            });
        }

        // „Ç∑„Çπ„ÉÜ„É†Áä∂ÊÖã„ÅÆÁ¢∫Ë™ç
        async function checkSystemStatus() {
            try {
                const response = await fetch('http://localhost:5002/api/unified/health');
                if (response.ok) {
                    const data = await response.json();
                    updateStatusIndicators(data.services);
                } else {
                    updateStatusIndicators({});
                }
            } catch (error) {
                console.error('„Ç∑„Çπ„ÉÜ„É†Áä∂ÊÖãÁ¢∫Ë™ç„Ç®„É©„Éº:', error);
                updateStatusIndicators({});
            }
        }

        // „Çπ„ÉÜ„Éº„Çø„Çπ„Ç§„É≥„Ç∏„Ç±„Éº„Çø„Éº„ÅÆÊõ¥Êñ∞
        function updateStatusIndicators(services) {
            const apiStatus = document.getElementById('apiStatus');
            const aiStatus = document.getElementById('aiStatus');
            const ragStatus = document.getElementById('ragStatus');

            // APIÁä∂ÊÖã
            apiStatus.className = 'status-indicator ' + (services.rag_system ? 'status-online' : 'status-offline');
            
            // AIÁä∂ÊÖã
            aiStatus.className = 'status-indicator ' + (services.openai_api ? 'status-online' : 'status-offline');
            
            // RAGÁä∂ÊÖã
            ragStatus.className = 'status-indicator ' + (services.rag_system ? 'status-online' : 'status-warning');
        }

        // „É¢„Éº„ÉâË®≠ÂÆö
        function setMode(mode) {
            currentMode = mode;
            console.log('„É¢„Éº„Éâ„ÇíÂ§âÊõ¥:', mode);
            
            // „Éú„Çø„É≥„ÅÆÁä∂ÊÖãÊõ¥Êñ∞
            document.querySelectorAll('.mode-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-mode="${mode}"]`).classList.add('active');
            
            // „É¢„Éº„Éâ„Å´Âøú„Åò„ÅüÂá¶ÁêÜ
            switch(mode) {
                case 'chat':
                    updateChatMode();
                    break;
                case 'diagnostic':
                    updateDiagnosticMode();
                    break;
                case 'repair_search':
                    updateRepairSearchMode();
                    break;
                case 'cost_estimate':
                    updateCostEstimateMode();
                    break;
                default:
                    console.log('Êú™Áü•„ÅÆ„É¢„Éº„Éâ:', mode);
            }
        }

        // „ÉÅ„É£„ÉÉ„Éà„É¢„Éº„Éâ„ÅÆÊõ¥Êñ∞
        function updateChatMode() {
            const chatInput = document.getElementById('chatInput');
            if (chatInput) {
                chatInput.placeholder = '‰øÆÁêÜ„Å´„Å§„ÅÑ„Å¶Ë≥™Âïè„Åó„Å¶„Åè„Å†„Åï„ÅÑ...';
            }
            console.log('„ÉÅ„É£„ÉÉ„Éà„É¢„Éº„Éâ„Å´Âàá„ÇäÊõø„Åà');
            
            // Ë®∫Êñ≠„Éï„É≠„Éº„Ç≥„É≥„ÉÜ„Éä„ÇíÈùûË°®Á§∫
            hideDiagnosticFlow();
        }

        // Ë®∫Êñ≠„Éï„É≠„Éº„ÇíÈùûË°®Á§∫
        function hideDiagnosticFlow() {
            const diagnosticContainer = document.getElementById('diagnosticFlowContainer');
            if (diagnosticContainer) {
                diagnosticContainer.classList.remove('active');
            }
        }

        // Ë®∫Êñ≠„É¢„Éº„Éâ„ÅÆÊõ¥Êñ∞
        function updateDiagnosticMode() {
            const chatInput = document.getElementById('chatInput');
            if (chatInput) {
                chatInput.placeholder = 'ÁóáÁä∂„ÇíË©≥„Åó„ÅèÊïô„Åà„Å¶„Åè„Å†„Åï„ÅÑÔºà‰æãÔºö„Ç®„Ç¢„Ç≥„É≥„ÅåÂäπ„Åã„Å™„ÅÑ„ÄÅÁï∞Èü≥„Åå„Åô„ÇãÔºâ...';
            }
            console.log('Ë®∫Êñ≠„É¢„Éº„Éâ„Å´Âàá„ÇäÊõø„Åà');
            
            // Ë®∫Êñ≠„Éï„É≠„Éº„Ç≥„É≥„ÉÜ„Éä„ÇíË°®Á§∫
            showDiagnosticFlow();
            
            // Ë®∫Êñ≠„Çª„ÉÉ„Ç∑„Éß„É≥„ÇíÈñãÂßã
            startDiagnosticSession();
        }

        // Ë®∫Êñ≠„Éï„É≠„Éº„ÇíË°®Á§∫
        function showDiagnosticFlow() {
            const diagnosticContainer = document.getElementById('diagnosticFlowContainer');
            if (diagnosticContainer) {
                diagnosticContainer.classList.add('active');
                diagnosticContainer.scrollIntoView({ behavior: 'smooth' });
            }
        }

        // Ë®∫Êñ≠„Çª„ÉÉ„Ç∑„Éß„É≥„ÇíÈñãÂßã
        async function startDiagnosticSession() {
            try {
                console.log('üîç Ë®∫Êñ≠„Çª„ÉÉ„Ç∑„Éß„É≥ÈñãÂßã');
                
                // Ë®∫Êñ≠ÈñãÂßãAPI„ÇíÂëº„Å≥Âá∫„Åó
                const response = await fetch('/chat/diagnose/start', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        category: getSelectedCategory(),
                        user_input: "Ê∞¥ÈÅì„Éù„É≥„Éó„Åã„ÇâÁï∞Èü≥„Åå„Åô„Çã" // „ÉÜ„Çπ„ÉàÁî®„ÅÆÂàùÊúüÂÖ•Âäõ
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                console.log('Ë®∫Êñ≠ÈñãÂßã„É¨„Çπ„Éù„É≥„Çπ:', data);

                if (data.session_id) {
                    diagnosticSession = data.session_id;
                    currentDiagnosticNode = data.node_id;
                    diagnosticHistory = [data.node_id];
                    
                    // „Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØË®∫Êñ≠„ÅÆÂ†¥Âêà„ÅØ„É°„ÉÉ„Çª„Éº„Ç∏„ÇíË°®Á§∫
                    if (data.fallback) {
                        addMessage('„Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØË®∫Êñ≠„É¢„Éº„Éâ„ÅßÈñãÂßã„Åó„Åæ„Åó„Åü„ÄÇÂü∫Êú¨ÁöÑ„Å™Ë®∫Êñ≠„ÇíË°å„ÅÑ„Åæ„Åô„ÄÇ', 'ai');
                    }
                    
                    // Ë®∫Êñ≠Ë≥™Âïè„ÇíË°®Á§∫
                    displayDiagnosticQuestion(data);
                    
                    // Á∑äÊÄ•Ë≠¶Âëä„Åå„ÅÇ„Çå„Å∞Ë°®Á§∫
                    if (data.safety && data.safety.urgent) {
                        showEmergencyWarning(data.safety.notes);
                    }
                } else {
                    throw new Error('Ë®∫Êñ≠„Çª„ÉÉ„Ç∑„Éß„É≥„ÅÆÈñãÂßã„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
                }
            } catch (error) {
                console.error('Ë®∫Êñ≠„Çª„ÉÉ„Ç∑„Éß„É≥ÈñãÂßã„Ç®„É©„Éº:', error);
                console.error('„Ç®„É©„ÉºË©≥Á¥∞:', error.message);
                console.error('„É¨„Çπ„Éù„É≥„Çπ„Çπ„ÉÜ„Éº„Çø„Çπ:', response?.status);
                console.error('„É¨„Çπ„Éù„É≥„ÇπÂÜÖÂÆπ:', data);
                
                // „Çà„ÇäË©≥Á¥∞„Å™„Ç®„É©„Éº„É°„ÉÉ„Çª„Éº„Ç∏„ÇíË°®Á§∫
                let errorMessage = 'Ë®∫Êñ≠„Ç∑„Çπ„ÉÜ„É†„ÅÆÂàùÊúüÂåñ„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ';
                if (error.message.includes('fetch')) {
                    errorMessage += ' „Çµ„Éº„Éê„Éº„Å´Êé•Á∂ö„Åß„Åç„Åæ„Åõ„Çì„ÄÇ';
                } else if (error.message.includes('JSON')) {
                    errorMessage += ' „É¨„Çπ„Éù„É≥„Çπ„ÅÆËß£Êûê„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ';
                } else {
                    errorMessage += ` „Ç®„É©„Éº: ${error.message}`;
                }
                errorMessage += ' ÈÄöÂ∏∏„ÅÆ„ÉÅ„É£„ÉÉ„Éà„É¢„Éº„Éâ„Çí„ÅîÂà©Áî®„Åè„Å†„Åï„ÅÑ„ÄÇ';
                
                addMessage(errorMessage, 'ai');
            }
        }

        // Ë®∫Êñ≠Ë≥™Âïè„ÇíË°®Á§∫
        function displayDiagnosticQuestion(data) {
            const questionElement = document.getElementById('currentQuestion');
            const progressElement = document.getElementById('progressText');
            
            if (questionElement) {
                questionElement.textContent = data.question || 'ÁóáÁä∂„ÇíË©≥„Åó„ÅèÊïô„Åà„Å¶„Åè„Å†„Åï„ÅÑ';
            }
            
            if (progressElement) {
                progressElement.textContent = 'Ë®∫Êñ≠ÈÄ≤Ë°å‰∏≠...';
            }
            
            // ÈÅ∏ÊäûËÇ¢„ÇíË°®Á§∫
            displayDiagnosticOptions(data.options || []);
        }

        // Ë®∫Êñ≠ÈÅ∏ÊäûËÇ¢„ÇíË°®Á§∫
        function displayDiagnosticOptions(options) {
            const optionsContainer = document.getElementById('diagnosticOptions');
            if (!optionsContainer) return;
            
            optionsContainer.innerHTML = '';
            
            if (options.length === 0) {
                // ÈÅ∏ÊäûËÇ¢„Åå„Å™„ÅÑÂ†¥Âêà„ÅØËá™Áî±ÂÖ•Âäõ
                optionsContainer.innerHTML = `
                    <div class="option-btn" onclick="submitDiagnosticAnswer('')">
                        Ëá™Áî±Ë®òËø∞„ÅßÂõûÁ≠î„Åô„Çã
                    </div>
                `;
            } else {
                options.forEach((option, index) => {
                    const optionBtn = document.createElement('div');
                    optionBtn.className = 'option-btn';
                    optionBtn.textContent = option.text || option;
                    optionBtn.onclick = () => submitDiagnosticAnswer(option.text || option);
                    optionsContainer.appendChild(optionBtn);
                });
            }
        }

        // Ë®∫Êñ≠ÂõûÁ≠î„ÇíÈÄÅ‰ø°
        async function submitDiagnosticAnswer(answer) {
            if (!diagnosticSession || !currentDiagnosticNode) {
                console.error('Ë®∫Êñ≠„Çª„ÉÉ„Ç∑„Éß„É≥„ÅåÁÑ°Âäπ„Åß„Åô');
                return;
            }

            try {
                console.log('üîç Ë®∫Êñ≠ÂõûÁ≠îÈÄÅ‰ø°:', answer);
                
                // ÈÅ∏Êäû„Åï„Çå„Åü„Éú„Çø„É≥„Çí„Éè„Ç§„É©„Ç§„Éà
                const selectedBtn = event.target;
                if (selectedBtn) {
                    selectedBtn.classList.add('selected');
                    setTimeout(() => selectedBtn.classList.remove('selected'), 1000);
                }
                
                // Ë®∫Êñ≠ÂõûÁ≠îAPI„ÇíÂëº„Å≥Âá∫„Åó
                const response = await fetch('/chat/diagnose/answer', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        session_id: diagnosticSession,
                        node_id: currentDiagnosticNode,
                        answer_text: answer
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                console.log('Ë®∫Êñ≠ÂõûÁ≠î„É¨„Çπ„Éù„É≥„Çπ:', data);

                if (data.is_terminated) {
                    // Ë®∫Êñ≠ÁµÇ‰∫Ü
                    displayDiagnosticResult(data);
                } else {
                    // Ê¨°„ÅÆË≥™Âïè„Å∏
                    currentDiagnosticNode = data.node_id;
                    diagnosticHistory.push(data.node_id);
                    displayDiagnosticQuestion(data);
                    updateProgress();
                }
            } catch (error) {
                console.error('Ë®∫Êñ≠ÂõûÁ≠î„Ç®„É©„Éº:', error);
                addMessage('Ë®∫Êñ≠Âá¶ÁêÜ‰∏≠„Å´„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü„ÄÇ', 'ai');
            }
        }

        // Ë®∫Êñ≠ÁµêÊûú„ÇíË°®Á§∫
        function displayDiagnosticResult(data) {
            console.log('üîç Ë®∫Êñ≠ÁµêÊûúË°®Á§∫:', data);
            
            // ÈÄ≤Êçó„Çí100%„Å´
            const progressFill = document.getElementById('progressFill');
            if (progressFill) {
                progressFill.style.width = '100%';
            }
            
            const progressText = document.getElementById('progressText');
            if (progressText) {
                progressText.textContent = 'Ë®∫Êñ≠ÂÆå‰∫Ü';
            }
            
            // Ë≥™Âïè„Ç®„É™„Ç¢„ÇíÈùûË°®Á§∫
            const questionArea = document.querySelector('.diagnostic-question');
            const optionsArea = document.getElementById('diagnosticOptions');
            if (questionArea) questionArea.style.display = 'none';
            if (optionsArea) optionsArea.style.display = 'none';
            
            // Ë®∫Êñ≠ÁµêÊûú„ÇíË°®Á§∫
            const resultContainer = document.getElementById('diagnosticResult');
            if (resultContainer) {
                resultContainer.classList.add('active');
                
                // Á¢∫‰ø°Â∫¶„ÇíË°®Á§∫
                const confidenceElement = document.getElementById('confidenceValue');
                if (confidenceElement && data.confidence) {
                    confidenceElement.textContent = `${Math.round(data.confidence * 100)}%`;
                }
                
                // Ë®∫Êñ≠ÁµêÊûúÂÜÖÂÆπ„ÇíË°®Á§∫
                const resultContent = document.getElementById('resultContent');
                if (resultContent && data.summary) {
                    resultContent.innerHTML = `
                        <div class="case-item">
                            <div class="case-title">${data.summary.title || 'Ë®∫Êñ≠ÁµêÊûú'}</div>
                            <div class="case-description">${data.summary.details || data.summary.next_steps || ''}</div>
                        </div>
                    `;
                }
                
                // Èñ¢ÈÄ£„Ç±„Éº„Çπ„ÇíË°®Á§∫
                if (data.related_cases && data.related_cases.length > 0) {
                    displayRelatedCases(data.related_cases);
                }
                
                // ÂøÖË¶Å„Å™ÈÉ®ÂìÅ„ÇíË°®Á§∫
                if (data.required_parts && data.required_parts.length > 0) {
                    displayRequiredParts(data.required_parts);
                }
            }
        }

        // Èñ¢ÈÄ£„Ç±„Éº„Çπ„ÇíË°®Á§∫
        function displayRelatedCases(cases) {
            const casesContainer = document.getElementById('relatedCasesContent');
            if (!casesContainer) return;
            
            casesContainer.innerHTML = '';
            
            cases.forEach(caseItem => {
                const caseElement = document.createElement('div');
                caseElement.className = 'case-item';
                
                const caseTitle = caseItem.title || caseItem.case_id || '‰øÆÁêÜ„Ç±„Éº„Çπ';
                const caseDescription = caseItem.description || caseItem.solution || '';
                const caseUrl = caseItem.url || '';
                
                caseElement.innerHTML = `
                    <div class="case-title">${caseTitle}</div>
                    <div class="case-description">${caseDescription}</div>
                    ${caseUrl ? `<div class="case-url"><a href="${caseUrl}" target="_blank">Ë©≥Á¥∞„ÇíË¶ã„Çã</a></div>` : ''}
                `;
                
                casesContainer.appendChild(caseElement);
            });
        }

        // ÂøÖË¶Å„Å™ÈÉ®ÂìÅ„ÇíË°®Á§∫
        function displayRequiredParts(parts) {
            const partsContainer = document.getElementById('requiredPartsContent');
            if (!partsContainer) return;
            
            partsContainer.innerHTML = '';
            
            parts.forEach(part => {
                const partElement = document.createElement('div');
                partElement.className = 'part-item';
                
                const partName = part.name || part.title || 'ÈÉ®ÂìÅ';
                const partInfo = part.description || part.info || '';
                const partPrice = part.price || '';
                
                partElement.innerHTML = `
                    <div class="part-name">${partName}</div>
                    <div class="part-info">${partInfo}</div>
                    ${partPrice ? `<div class="part-price">ÂèÇËÄÉ‰æ°Ê†º: ${partPrice}</div>` : ''}
                `;
                
                partsContainer.appendChild(partElement);
            });
        }

        // Á∑äÊÄ•Ë≠¶Âëä„ÇíË°®Á§∫
        function showEmergencyWarning(message) {
            const warningElement = document.getElementById('emergencyWarning');
            const warningText = document.getElementById('emergencyText');
            
            if (warningElement && warningText) {
                warningText.textContent = message;
                warningElement.classList.remove('hidden');
                warningElement.scrollIntoView({ behavior: 'smooth' });
            }
        }

        // ÈÄ≤Êçó„ÇíÊõ¥Êñ∞
        function updateProgress() {
            const progressFill = document.getElementById('progressFill');
            const progressStep = document.getElementById('progressStep');
            
            if (progressFill && diagnosticHistory.length > 0) {
                const progress = Math.min((diagnosticHistory.length / 5) * 100, 90); // ÊúÄÂ§ß90%„Åæ„Åß
                progressFill.style.width = `${progress}%`;
            }
            
            if (progressStep) {
                progressStep.textContent = `${diagnosticHistory.length}/5`;
            }
        }

        // ÈÅ∏Êäû„Åï„Çå„Åü„Ç´„ÉÜ„Ç¥„É™„ÇíÂèñÂæó
        function getSelectedCategory() {
            // ÁèæÂú®„ÅÆ„É¢„Éº„Éâ„ÇÑ„É¶„Éº„Ç∂„Éº„ÅÆÈÅ∏Êäû„Å´Âü∫„Å•„ÅÑ„Å¶„Ç´„ÉÜ„Ç¥„É™„ÇíÊ±∫ÂÆö
            // Á∞°ÊòìÂÆüË£Ö„Å®„Åó„Å¶„ÄÅË®∫Êñ≠„É¢„Éº„Éâ„Åß„ÅØ‰∏ÄËà¨ÁöÑ„Å™„Ç´„ÉÜ„Ç¥„É™„ÇíËøî„Åô
            return 'general';
        }

        // ‰øÆÁêÜÊ§úÁ¥¢„É¢„Éº„Éâ„ÅÆÊõ¥Êñ∞
        function updateRepairSearchMode() {
            const chatInput = document.getElementById('chatInput');
            if (chatInput) {
                chatInput.placeholder = '‰øÆÁêÜ„Åó„Åü„ÅÑÈÉ®ÂìÅ„ÇÑÁóáÁä∂„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ...';
            }
            console.log('‰øÆÁêÜÊ§úÁ¥¢„É¢„Éº„Éâ„Å´Âàá„ÇäÊõø„Åà');
        }

        // ‰øÆÁêÜ„Ç¢„Éâ„Éê„Ç§„Çπ„Çª„É≥„Çø„Éº„ÅÆÊõ¥Êñ∞
        function updateCostEstimateMode() {
            console.log('‰øÆÁêÜ„Ç¢„Éâ„Éê„Ç§„Çπ„Çª„É≥„Çø„Éº„Å´Âàá„ÇäÊõø„Åà - ‰øÆÁêÜ„Ç¢„Éâ„Éê„Ç§„Çπ„Çª„É≥„Çø„Éº„Å´ÈÅ∑Áßª„Åó„Åæ„Åô');
            
            // ‰øÆÁêÜ„Ç¢„Éâ„Éê„Ç§„Çπ„Çª„É≥„Çø„Éº„Å´ÈÅ∑Áßª
            window.location.href = '/repair_advice_center.html';
        }

        // „É°„ÉÉ„Çª„Éº„Ç∏ÈÄÅ‰ø°
        async function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message || isProcessing) return;
            
            // „É¶„Éº„Ç∂„Éº„É°„ÉÉ„Çª„Éº„Ç∏„ÇíË°®Á§∫
            addMessage(message, 'user');
            input.value = '';
            
            // Âá¶ÁêÜÈñãÂßã
            setProcessing(true);
            
            // „É¢„Éº„Éâ„Å´Âøú„Åò„Åü„É°„ÉÉ„Çª„Éº„Ç∏„ÅÆÂâçÂá¶ÁêÜ
            let processedMessage = message;
            if (currentMode === 'cost_estimate') {
                // ‰øÆÁêÜ„Ç¢„Éâ„Éê„Ç§„Çπ„Çª„É≥„Çø„Éº„ÅÆÂ†¥Âêà„ÅØ„ÄÅ‰øÆÁêÜ„Ç¢„Éâ„Éê„Ç§„Çπ„Çª„É≥„Çø„Éº„Å´Ë™òÂ∞é
                addMessage(`
                    <div style="background: linear-gradient(135deg, #28a745, #20c997); color: white; padding: 20px; border-radius: 15px; margin: 10px 0; text-align: center;">
                        <h3 style="margin: 0 0 15px 0; font-size: 1.3rem;">üîß ‰øÆÁêÜ„Ç¢„Éâ„Éê„Ç§„Çπ„Çª„É≥„Çø„Éº</h3>
                        <p style="margin: 0 0 15px 0; font-size: 1.1rem;">„Äå${message}„Äç„Å´„Å§„ÅÑ„Å¶</p>
                        <p style="margin: 0 0 15px 0; font-size: 1rem;">Ë©≥Á¥∞„Å™‰æ°Ê†ºÊÉÖÂ†±„Å®ÂïÜÂìÅ„Éá„Éº„Çø„ÇíÁ¢∫Ë™ç„Åô„Çã„Å´„ÅØ„ÄÅ‰øÆÁêÜ„Ç¢„Éâ„Éê„Ç§„Çπ„Çª„É≥„Çø„Éº„Çí„ÅîÂà©Áî®„Åè„Å†„Åï„ÅÑ„ÄÇ</p>
                        <button onclick="openRepairAdviceCenter()" style="
                            background: white; 
                            color: #28a745; 
                            border: none; 
                            padding: 12px 24px; 
                            border-radius: 25px; 
                            font-weight: bold; 
                            font-size: 1rem; 
                            cursor: pointer; 
                            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
                            transition: all 0.3s ease;
                        " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(0,0,0,0.3)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(0,0,0,0.2)'">
                            üöÄ ‰øÆÁêÜ„Ç¢„Éâ„Éê„Ç§„Çπ„Çª„É≥„Çø„Éº„ÅßË©≥Á¥∞„ÇíÁ¢∫Ë™ç
                        </button>
                    </div>
                `, 'ai');
                setProcessing(false);
                return;
            } else if (currentMode === 'diagnostic') {
                processedMessage = `ÁóáÁä∂Ë®∫Êñ≠: ${message}`;
                
                // Ë®∫Êñ≠„É¢„Éº„Éâ„Åß„ÅØËøΩÂä†„ÅÆË®∫Êñ≠ÊÉÖÂ†±„ÇíÊèê‰æõ
                setTimeout(() => {
                    addMessage(`
                        <div style="background: #e3f2fd; border-left: 4px solid #2196f3; padding: 15px; margin: 10px 0; border-radius: 8px;">
                            <h4 style="margin: 0 0 10px 0; color: #1976d2;">üîç Ë®∫Êñ≠„ÇíÈÄ≤„ÇÅ„Çã„Åü„ÇÅ„Å´</h4>
                            <p style="margin: 0 0 10px 0; color: #424242;">
                                „Çà„ÇäË©≥Á¥∞„Å™Ë®∫Êñ≠„ÇíË°å„ÅÜ„Åü„ÇÅ„Å´„ÄÅ‰ª•‰∏ã„ÅÆÁÇπ„Å´„Å§„ÅÑ„Å¶„ÇÇÊïô„Åà„Å¶„Åè„Å†„Åï„ÅÑÔºö
                            </p>
                            <ul style="margin: 0; color: #424242; padding-left: 20px;">
                                <li>ÁóáÁä∂„ÅåÁô∫Áîü„Åô„ÇãÊù°‰ª∂Ôºà„Ç®„É≥„Ç∏„É≥ÂßãÂãïÊôÇ„ÄÅËµ∞Ë°å‰∏≠„ÄÅÂÅúËªäÊôÇ„Å™„Å©Ôºâ</li>
                                <li>Áï∞Â∏∏Èü≥„ÇÑÊåØÂãï„ÅÆÊúâÁÑ°</li>
                                <li>Ë≠¶ÂëäÁÅØ„ÅÆÁÇπÁÅØÁä∂Ê≥Å</li>
                                <li>ÊúÄËøë„ÅÆ‰øÆÁêÜ„Éª‰∫§ÊèõÂ±•Ê≠¥</li>
                            </ul>
                            <p style="margin: 10px 0 0 0; color: #1976d2; font-size: 0.9rem;">
                                üí° Ë©≥Á¥∞„Å™Ë®∫Êñ≠„Å´„ÅØ‰øÆÁêÜ„Ç¢„Éâ„Éê„Ç§„Çπ„Çª„É≥„Çø„Éº„ÇÇ„ÅîÂà©Áî®„Åè„Å†„Åï„ÅÑ
                            </p>
                        </div>
                    `, 'ai');
                }, 2000);
            } else if (currentMode === 'repair_search') {
                processedMessage = `‰øÆÁêÜÊ§úÁ¥¢: ${message}`;
            }
            
            try {
                const response = await fetch('http://localhost:5002/ask', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: new URLSearchParams({
                        question: processedMessage
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    displayResponse(data);
                } else {
                    const error = await response.json();
                    addMessage(`‚ùå „Ç®„É©„Éº: ${error.error}`, 'ai');
                }
            } catch (error) {
                addMessage(`‚ùå Êé•Á∂ö„Ç®„É©„Éº: ${error.message}`, 'ai');
            } finally {
                setProcessing(false);
            }
        }

        // „ÇØ„Ç§„ÉÉ„ÇØ„É°„ÉÉ„Çª„Éº„Ç∏ÈÄÅ‰ø°
        function sendQuickMessage(message) {
            document.getElementById('chatInput').value = message;
            sendMessage();
        }

        // „É¨„Çπ„Éù„É≥„ÇπË°®Á§∫
        function displayResponse(data) {
            if (data.error) {
                addMessage(`‚ùå „Ç®„É©„Éº: ${data.error}`, 'ai');
                return;
            }
            
            let responseText = '';
            
            if (data.answer) {
                responseText = data.answer;
            } else if (data.type === 'chat') {
                responseText = data.response;
            } else if (data.type === 'diagnostic') {
                responseText = formatDiagnosticResponse(data);
            } else if (data.type === 'repair_search') {
                responseText = formatRepairSearchResponse(data);
            } else if (data.type === 'cost_estimate') {
                responseText = formatCostEstimateResponse(data);
            }
            
            addMessage(responseText, 'ai');
            
            // „Éá„Éê„ÉÉ„Ç∞ÊÉÖÂ†±„ÅÆË°®Á§∫ÔºàÈùûË°®Á§∫Ôºâ
            // if (debugMode) {
            //     showDebugInfo(data);
            // }
        }

        // Ë®∫Êñ≠„É¨„Çπ„Éù„É≥„Çπ„ÅÆ„Éï„Ç©„Éº„Éû„ÉÉ„Éà
        function formatDiagnosticResponse(data) {
            let response = '';
            
            if (data.type === 'notion_diagnostic') {
                // NotionË®∫Êñ≠„Éï„É≠„Éº„ÅÆÁµêÊûú
                response += 'üîç **NotionË®∫Êñ≠„Éï„É≠„Éº**\n\n';
                
                if (data.current_node) {
                    const node = data.current_node;
                    response += `**Ë®∫Êñ≠„Éé„Éº„Éâ:** ${node.title || 'Unknown'}\n`;
                    response += `**„Ç´„ÉÜ„Ç¥„É™:** ${node.category || 'N/A'}\n\n`;
                    
                    if (node.symptoms && node.symptoms.length > 0) {
                        response += `**Èñ¢ÈÄ£ÁóáÁä∂:**\n`;
                        node.symptoms.forEach(symptom => {
                            response += `‚Ä¢ ${symptom}\n`;
                        });
                        response += '\n';
                    }
                }
                
                if (data.related_cases && data.related_cases.length > 0) {
                    response += `**Èñ¢ÈÄ£‰øÆÁêÜ„Ç±„Éº„Çπ:**\n`;
                    data.related_cases.slice(0, 3).forEach(case_item => {
                        response += `‚Ä¢ ${case_item.title || 'Unknown Case'}\n`;
                        if (case_item.solution) {
                            response += `  - ${case_item.solution.substring(0, 100)}...\n`;
                        }
                    });
                    response += '\n';
                }
                
                response += `**Ë®∫Êñ≠‰ø°È†ºÂ∫¶:** ${Math.round((data.confidence || 0) * 100)}%\n`;
                
            } else if (data.diagnosis) {
                // AIË®∫Êñ≠„ÅÆÁµêÊûú
                response += 'üîç **AIË®∫Êñ≠ÁµêÊûú**\n\n';
                
                response += `**ÂèØËÉΩÊÄß„ÅÆ„ÅÇ„ÇãÂéüÂõ†:**\n`;
                data.diagnosis.possible_causes.forEach(cause => {
                    response += `‚Ä¢ ${cause}\n`;
                });
                
                response += `\n**Êé®Â•®ÂØæÂá¶Ê≥ï:**\n`;
                data.diagnosis.recommended_actions.forEach(action => {
                    response += `‚Ä¢ ${action}\n`;
                });
                
                response += `\n**Á∑äÊÄ•Â∫¶:** ${data.diagnosis.urgency}\n`;
                response += `**‰ø°È†ºÂ∫¶:** ${Math.round(data.diagnosis.confidence * 100)}%\n`;
                
                if (data.fallback) {
                    response += `\n‚ö†Ô∏è **Ê≥®ÊÑè:** NotionË®∫Êñ≠„ÅåÂà©Áî®„Åß„Åç„Å™„ÅÑ„Åü„ÇÅ„ÄÅAIË®∫Êñ≠„Çí‰ΩøÁî®„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ\n`;
                }
            }
            
            return response;
        }

        // ‰øÆÁêÜÊ§úÁ¥¢„É¨„Çπ„Éù„É≥„Çπ„ÅÆ„Éï„Ç©„Éº„Éû„ÉÉ„Éà
        function formatRepairSearchResponse(data) {
            let response = 'üõ†Ô∏è **‰øÆÁêÜÊ§úÁ¥¢ÁµêÊûú**\n\n';
            
            if (data.repair_info && data.repair_info.category) {
                response += `**„Ç´„ÉÜ„Ç¥„É™:** ${data.repair_info.category}\n`;
                response += `**„Ç¢„Ç§„Ç≥„É≥:** ${data.repair_info.icon}\n\n`;
                
                if (data.repair_info.repair_costs) {
                    response += `**‰øÆÁêÜË≤ªÁî®:**\n${data.repair_info.repair_costs}\n\n`;
                }
                
                if (data.repair_info.repair_steps) {
                    response += `**‰øÆÁêÜÊâãÈ†Ü:**\n${data.repair_info.repair_steps}\n\n`;
                }
                
                if (data.repair_info.warnings) {
                    response += `**Ê≥®ÊÑè‰∫ãÈ†Ö:**\n${data.repair_info.warnings}\n\n`;
                }
            }
            
            return response;
        }

        // Ë≤ªÁî®Ë¶ãÁ©ç„ÇÇ„Çä„É¨„Çπ„Éù„É≥„Çπ„ÅÆ„Éï„Ç©„Éº„Éû„ÉÉ„Éà
        function formatCostEstimateResponse(data) {
            let response = 'üí∞ **Ë≤ªÁî®Ë¶ãÁ©ç„ÇÇ„Çä**\n\n';
            
            if (data.category) {
                response += `**„Ç´„ÉÜ„Ç¥„É™:** ${data.category}\n\n`;
            }
            
            if (data.cost_info) {
                response += `**Ë≤ªÁî®ÊÉÖÂ†±:**\n${data.cost_info}\n\n`;
            }
            
            if (data.price_results && data.price_results.results) {
                response += `**‰æ°Ê†ºÊÉÖÂ†±:**\n`;
                data.price_results.results.forEach((item, index) => {
                    response += `${index + 1}. ${item.title}\n`;
                    if (item.price_info && item.price_info.price) {
                        response += `   ‰æ°Ê†º: ${item.price_info.price}ÂÜÜ\n`;
                    }
                    response += `   URL: ${item.url}\n\n`;
                });
            }
            
            return response;
        }

        // „É°„ÉÉ„Çª„Éº„Ç∏ËøΩÂä†
        function addMessage(content, type) {
            const messagesContainer = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message message-${type}`;
            messageDiv.innerHTML = formatMessageContent(content);
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        // „É°„ÉÉ„Çª„Éº„Ç∏„Ç≥„É≥„ÉÜ„É≥„ÉÑ„ÅÆ„Éï„Ç©„Éº„Éû„ÉÉ„Éà
        function formatMessageContent(content) {
            console.log('ÂÖÉ„ÅÆ„Ç≥„É≥„ÉÜ„É≥„ÉÑ:', content);
            
            // „Éû„Éº„ÇØ„ÉÄ„Ç¶„É≥È¢®„ÅÆ„Éï„Ç©„Éº„Éû„ÉÉ„Éà
            let formatted = content
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\*(.*?)\*/g, '<em>$1</em>')
                .replace(/\n/g, '<br>');
            
            console.log('„Éû„Éº„ÇØ„ÉÄ„Ç¶„É≥Â§âÊèõÂæå:', formatted);
            
            // „Éñ„É≠„Ç∞„É™„É≥„ÇØ„ÅÆË°®Á§∫„ÇíÊîπÂñÑ
            formatted = formatBlogLinks(formatted);
            
            console.log('„Éñ„É≠„Ç∞„É™„É≥„ÇØÂ§âÊèõÂæå:', formatted);
            
            // URL„Çí„ÇØ„É™„ÉÉ„ÇØÂèØËÉΩ„Å™„É™„É≥„ÇØ„Å´Â§âÊèõ
            formatted = convertUrlsToLinks(formatted);
            
            console.log('ÊúÄÁµÇÁöÑ„Å™„Éï„Ç©„Éº„Éû„ÉÉ„Éà:', formatted);
            
            return formatted;
        }

        // URL„Çí„ÇØ„É™„ÉÉ„ÇØÂèØËÉΩ„Å™„É™„É≥„ÇØ„Å´Â§âÊèõ
        function convertUrlsToLinks(text) {
            // „Çà„ÇäÁ∞°Âçò„ÅßÁ¢∫ÂÆü„Å™URLÊ§úÂá∫
            const urlPattern = /(https?:\/\/[^\s]+)/g;
            return text.replace(urlPattern, function(url) {
                // URL„ÅåÊó¢„Å´„É™„É≥„ÇØ„Çø„Ç∞„ÅßÂõ≤„Åæ„Çå„Å¶„ÅÑ„ÇãÂ†¥Âêà„ÅØ„Çπ„Ç≠„ÉÉ„Éó
                if (text.includes(`<a href="${url}">`)) {
                    return url;
                }
                console.log('URL„ÇíÊ§úÂá∫:', url);
                return `<a href="${url}" target="_blank" rel="noopener noreferrer" style="color: #667eea; text-decoration: underline; font-weight: bold; cursor: pointer;">${url}</a>`;
            });
        }

        // „Éñ„É≠„Ç∞Ë®ò‰∫ã„ÅÆË°®Á§∫„ÇíÊîπÂñÑ
        function formatBlogLinks(content) {
            // „Éñ„É≠„Ç∞Ë®ò‰∫ã„ÅÆ„Éë„Çø„Éº„É≥„ÇíÊ§úÂá∫„Åó„Å¶ÊîπÂñÑÔºà„Çà„ÇäÊüîËªü„Å™„Éë„Çø„Éº„É≥Ôºâ
            const blogPattern = /‚Ä¢\s*([^:]+):\s*(https?:\/\/[^\s<>"{}|\\^`[\]]+)/g;
            return content.replace(blogPattern, function(match, title, url) {
                return `<div class="blog-link-item" style="margin: 10px 0; padding: 10px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #667eea; cursor: pointer;" onclick="window.open('${url}', '_blank')">
                    <div class="blog-title" style="font-weight: bold; color: #333; margin-bottom: 5px;">${title}</div>
                    <div style="color: #667eea; font-size: 0.9rem; text-decoration: underline;">
                        üîó ${url}
                    </div>
                </div>`;
            });
        }

        // Âá¶ÁêÜÁä∂ÊÖã„ÅÆË®≠ÂÆö
        function setProcessing(processing) {
            isProcessing = processing;
            const loading = document.getElementById('loading');
            const sendBtn = document.getElementById('sendBtn');
            
            if (processing) {
                loading.classList.add('show');
                sendBtn.disabled = true;
                sendBtn.textContent = 'Âá¶ÁêÜ‰∏≠...';
            } else {
                loading.classList.remove('show');
                sendBtn.disabled = false;
                sendBtn.textContent = 'ÈÄÅ‰ø°';
            }
        }

        // „Ç≠„ÉºÂÖ•ÂäõÂá¶ÁêÜ
        function handleKeyPress(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        }

        // „Éá„Éê„ÉÉ„Ç∞ÊÉÖÂ†±„ÅÆË°®Á§∫
        function showDebugInfo(data) {
            const debugContent = document.getElementById('debugContent');
            debugContent.textContent = JSON.stringify(data, null, 2);
        }

        // „Éá„Éê„ÉÉ„Ç∞ÊÉÖÂ†±„ÇíÂèñÂæó
        async function fetchDebugInfo() {
            try {
                const response = await fetch('http://localhost:5002/api/unified/debug');
                if (response.ok) {
                    const debugData = await response.json();
                    displayDebugInfo(debugData);
                } else {
                    console.error('„Éá„Éê„ÉÉ„Ç∞ÊÉÖÂ†±„ÅÆÂèñÂæó„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
                }
            } catch (error) {
                console.error('„Éá„Éê„ÉÉ„Ç∞ÊÉÖÂ†±ÂèñÂæó„Ç®„É©„Éº:', error);
            }
        }

        // „Éá„Éê„ÉÉ„Ç∞ÊÉÖÂ†±„ÇíË°®Á§∫
        function displayDebugInfo(data) {
            const debugContent = document.getElementById('debugContent');
            let html = '<div style="font-family: Arial, sans-serif;">';
            
            // Áí∞Â¢ÉÂ§âÊï∞„ÉÅ„Çß„ÉÉ„ÇØ
            html += '<h3 style="color: #667eea; margin-bottom: 10px;">üîß Áí∞Â¢ÉÂ§âÊï∞„ÉÅ„Çß„ÉÉ„ÇØ</h3>';
            html += '<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px;">';
            for (const [key, value] of Object.entries(data.environment_variables)) {
                const color = value.includes('‚úÖ') ? '#28a745' : '#dc3545';
                html += `<div style="padding: 5px; border: 1px solid #dee2e6; border-radius: 5px;"><strong>${key}:</strong> <span style="color: ${color}">${value}</span></div>`;
            }
            html += '</div>';
            
            // API„Ç≠„ÉºÊÉÖÂ†±
            html += '<h3 style="color: #667eea; margin-bottom: 10px;">üîë API„Ç≠„ÉºÊÉÖÂ†±</h3>';
            html += '<div style="margin-bottom: 20px;">';
            for (const [key, value] of Object.entries(data.api_keys)) {
                if (value) {
                    html += `<div style="padding: 5px; background: #f8f9fa; border-radius: 5px; margin-bottom: 5px;"><strong>${key}:</strong> ${value}</div>`;
                }
            }
            html += '</div>';
            
            // „Éá„Éº„Çø„Éô„Éº„ÇπID
            html += '<h3 style="color: #667eea; margin-bottom: 10px;">üóÑÔ∏è „Éá„Éº„Çø„Éô„Éº„ÇπID</h3>';
            html += '<div style="margin-bottom: 20px;">';
            for (const [key, value] of Object.entries(data.database_ids)) {
                const color = value ? '#28a745' : '#dc3545';
                html += `<div style="padding: 5px; background: #f8f9fa; border-radius: 5px; margin-bottom: 5px;"><strong>${key}:</strong> <span style="color: ${color}">${value || 'Êú™Ë®≠ÂÆö'}</span></div>`;
            }
            html += '</div>';
            
            // „Éï„Ç°„Ç§„É´„ÉÅ„Çß„ÉÉ„ÇØ
            html += '<h3 style="color: #667eea; margin-bottom: 10px;">üìÅ „Éï„Ç°„Ç§„É´„ÉÅ„Çß„ÉÉ„ÇØ</h3>';
            html += '<div style="margin-bottom: 20px;">';
            for (const [key, value] of Object.entries(data.file_checks)) {
                const color = value.includes('‚úÖ') ? '#28a745' : '#dc3545';
                html += `<div style="padding: 5px; background: #f8f9fa; border-radius: 5px; margin-bottom: 5px;"><strong>${key}:</strong> <span style="color: ${color}">${value}</span></div>`;
            }
            html += '</div>';
            
            // „Çµ„Éº„Éì„ÇπÁä∂ÊÖã
            html += '<h3 style="color: #667eea; margin-bottom: 10px;">‚öôÔ∏è „Çµ„Éº„Éì„ÇπÁä∂ÊÖã</h3>';
            html += '<div style="margin-bottom: 20px;">';
            for (const [key, value] of Object.entries(data.services_status)) {
                const color = value ? '#28a745' : '#dc3545';
                const status = value ? '‚úÖ Âãï‰Ωú‰∏≠' : '‚ùå ÂÅúÊ≠¢';
                html += `<div style="padding: 5px; background: #f8f9fa; border-radius: 5px; margin-bottom: 5px;"><strong>${key}:</strong> <span style="color: ${color}">${status}</span></div>`;
            }
            html += '</div>';
            
            // „Éá„Éº„ÇøÂèØÁî®ÊÄß
            html += '<h3 style="color: #667eea; margin-bottom: 10px;">üìä „Éá„Éº„ÇøÂèØÁî®ÊÄß</h3>';
            html += '<div style="margin-bottom: 20px;">';
            const diagnosticColor = data.diagnostic_data_available ? '#28a745' : '#dc3545';
            const repairColor = data.repair_cases_available ? '#28a745' : '#dc3545';
            html += `<div style="padding: 5px; background: #f8f9fa; border-radius: 5px; margin-bottom: 5px;"><strong>Ë®∫Êñ≠„Éá„Éº„Çø:</strong> <span style="color: ${diagnosticColor}">${data.diagnostic_data_available ? '‚úÖ Âà©Áî®ÂèØËÉΩ' : '‚ùå Âà©Áî®‰∏çÂèØ'}</span></div>`;
            html += `<div style="padding: 5px; background: #f8f9fa; border-radius: 5px; margin-bottom: 5px;"><strong>‰øÆÁêÜ„Ç±„Éº„Çπ:</strong> <span style="color: ${repairColor}">${data.repair_cases_available ? '‚úÖ Âà©Áî®ÂèØËÉΩ' : '‚ùå Âà©Áî®‰∏çÂèØ'}</span></div>`;
            html += '</div>';
            
            html += '</div>';
            debugContent.innerHTML = html;
        }

        // „Éá„Éê„ÉÉ„Ç∞„É¢„Éº„Éâ„ÅÆÂàá„ÇäÊõø„ÅàÔºàÈùûË°®Á§∫Ôºâ
        function toggleDebug() {
            // debugMode = !debugMode;
            // const debugPanel = document.getElementById('debugPanel');
            // debugPanel.classList.toggle('show');
            
            // if (debugMode) {
            //     fetchDebugInfo();
            // }
        }
    </script>
</body>
</html>
