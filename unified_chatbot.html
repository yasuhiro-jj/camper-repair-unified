<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ”§ ã‚­ãƒ£ãƒ³ãƒ”ãƒ³ã‚°ã‚«ãƒ¼ä¿®ç†ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .hidden {
            display: none !important;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        .header h1 {
            color: #667eea;
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        .header p {
            color: #666;
            font-size: 1.2rem;
            margin-bottom: 20px;
        }

        .status-bar {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
        }

        .status-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }

        .status-online { background-color: #28a745; }
        .status-offline { background-color: #dc3545; }
        .status-warning { background-color: #ffc107; }

        .chat-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            min-height: 500px;
        }

        .chat-messages {
            max-height: 400px;
            overflow-y: auto;
            margin-bottom: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 15px;
            border: 2px solid #e9ecef;
        }

        .message {
            margin: 15px 0;
            padding: 15px 20px;
            border-radius: 20px;
            max-width: 80%;
            word-wrap: break-word;
            animation: fadeIn 0.3s ease-in;
        }

        .message-user {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            margin-left: auto;
            border-radius: 20px 20px 5px 20px;
        }

        .message-ai {
            background: white;
            color: #333;
            border: 2px solid #e9ecef;
            border-radius: 20px 20px 20px 5px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .message-system {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
            border-radius: 10px;
            text-align: center;
            font-style: italic;
        }

        .input-container {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        .chat-input {
            flex: 1;
            padding: 15px 20px;
            border: 2px solid #667eea;
            border-radius: 25px;
            font-size: 1rem;
            outline: none;
            transition: all 0.3s ease;
        }

        .chat-input:focus {
            border-color: #764ba2;
            box-shadow: 0 0 15px rgba(102, 126, 234, 0.3);
        }

        .send-btn {
            padding: 15px 30px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .send-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .send-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .mode-selector {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .mode-btn {
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid transparent;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .mode-btn.active {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border-color: #667eea;
        }

        .mode-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .loading {
            display: none;
            text-align: center;
            color: #667eea;
            font-style: italic;
        }

        .loading.show {
            display: block;
        }

        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(100%); }
            to { opacity: 1; transform: translateX(0); }
        }

        @keyframes slideOut {
            from { opacity: 1; transform: translateX(0); }
            to { opacity: 0; transform: translateX(100%); }
        }

        .debug-panel {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            display: none;
        }

        .debug-panel.show {
            display: block;
        }

        .debug-title {
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
        }

        .debug-content {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 5px;
            padding: 10px;
            font-family: monospace;
            font-size: 0.9rem;
            max-height: 200px;
            overflow-y: auto;
        }

        /* è¨ºæ–­ãƒ•ãƒ­ãƒ¼å°‚ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
        .diagnostic-flow-container {
            background: linear-gradient(135deg, #e8f5e8 0%, #f0f8ff 100%);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            border-left: 5px solid #28a745;
            display: none;
        }

        .diagnostic-flow-container.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .diagnostic-progress {
            margin-bottom: 20px;
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .progress-text {
            font-weight: bold;
            color: #28a745;
        }

        .progress-bar {
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #28a745, #20c997);
            border-radius: 4px;
            transition: width 0.5s ease;
            width: 0%;
        }

        .diagnostic-question {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .diagnostic-question h3 {
            color: #28a745;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        .diagnostic-question p {
            color: #333;
            font-size: 1.1rem;
            line-height: 1.6;
            margin: 0;
        }

        .diagnostic-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .option-btn {
            padding: 15px 20px;
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
            font-size: 1rem;
            color: #333;
        }

        .option-btn:hover {
            border-color: #28a745;
            background: #f8fff8;
            transform: translateX(5px);
        }

        .option-btn.selected {
            border-color: #28a745;
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
        }

        .diagnostic-result {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-top: 20px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
            display: none;
        }

        .diagnostic-result.active {
            display: block;
            animation: slideIn 0.5s ease;
        }

        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e0e0e0;
        }

        .result-header h3 {
            color: #28a745;
            margin: 0;
            font-size: 1.4rem;
        }

        .confidence-meter {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .confidence-value {
            background: linear-gradient(45deg, #28a745, #20c997);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9rem;
        }

        .related-cases, .required-parts {
            margin-bottom: 25px;
        }

        .related-cases h4, .required-parts h4 {
            color: #495057;
            margin-bottom: 15px;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .case-item, .part-item {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 12px;
            border-left: 4px solid #28a745;
        }

        .case-title, .part-name {
            font-weight: bold;
            color: #495057;
            margin-bottom: 8px;
        }

        .case-description, .part-info {
            color: #6c757d;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .case-url, .part-price {
            margin-top: 8px;
            font-size: 0.8rem;
        }

        .case-url a {
            color: #28a745;
            text-decoration: none;
        }

        .case-url a:hover {
            text-decoration: underline;
        }

        .emergency-warning {
            background: linear-gradient(135deg, #dc3545, #e74c3c);
            color: white;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
            border-left: 5px solid #c82333;
        }

        .emergency-warning h4 {
            margin: 0 0 10px 0;
            font-size: 1.1rem;
        }

        .emergency-warning p {
            margin: 0;
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .quick-actions {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .quick-btn {
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid #667eea;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .quick-btn:hover {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
        }

        .new-conversation-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            margin: 20px 0;
        }

        .new-conversation-btn {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
        }

        .new-conversation-btn:hover {
            background: linear-gradient(135deg, #218838, #1ea085);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4);
        }

        .conversation-info {
            font-size: 0.9rem;
            color: #666;
            font-style: italic;
        }

        /* ãƒªãƒ³ã‚¯ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .message a {
            color: #667eea;
            text-decoration: underline;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .message a:hover {
            color: #5a6fd8;
            text-decoration: none;
            background-color: rgba(102, 126, 234, 0.1);
            padding: 2px 4px;
            border-radius: 4px;
        }

        .blog-link-item {
            transition: all 0.3s ease;
        }

        .blog-link-item:hover {
            background-color: #e9ecef !important;
            transform: translateX(5px);
        }

        .blog-link-item a:hover {
            color: #5a6fd8 !important;
            text-decoration: underline !important;
        }

        .footer {
            text-align: center;
            color: rgba(255, 255, 255, 0.8);
            margin-top: 30px;
        }

        /* é–¢é€£ãƒ–ãƒ­ã‚°ãƒªãƒ³ã‚¯ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .blog-link {
            color: #667eea;
            text-decoration: none;
            padding: 8px 12px;
            background: white;
            border-radius: 8px;
            border: 1px solid #e9ecef;
            transition: all 0.3s ease;
            display: block;
            margin-bottom: 8px;
        }

        .blog-link:hover {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
        <div class="header">
            <h1>ğŸ”§ ã‚­ãƒ£ãƒ³ãƒ”ãƒ³ã‚°ã‚«ãƒ¼ä¿®ç†ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆ</h1>
            <p class="hidden">AIè¨ºæ–­ + RAGæ¤œç´¢ + ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æƒ…å ± + å°‚é–€çŸ¥è­˜ = ä¿®ç†æ”¯æ´</p>
            
            <!-- æ–°ã—ã„ä¼šè©±é–‹å§‹ãƒœã‚¿ãƒ³ -->
            <div class="new-conversation-section hidden">
                <button class="new-conversation-btn" onclick="startNewConversation()">
                    ğŸ†• æ–°ã—ã„ä¼šè©±ã‚’é–‹å§‹
                </button>
                <span class="conversation-info">æ–°ã—ã„ã‚»ãƒƒã‚·ãƒ§ãƒ³ã§APIã‚­ãƒ¼ã‚’æ›´æ–°</span>
            </div>
            
            <!-- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒ¼ -->
            <div class="status-bar hidden">
                <div class="status-item">
                    <div class="status-indicator status-offline" id="apiStatus"></div>
                    <span>çµ±åˆAPI</span>
                </div>
                <div class="status-item">
                    <div class="status-indicator status-offline" id="aiStatus"></div>
                    <span>AI ã‚¨ãƒ³ã‚¸ãƒ³</span>
                </div>
                <div class="status-item">
                    <div class="status-indicator status-offline" id="ragStatus"></div>
                    <span>RAG ã‚·ã‚¹ãƒ†ãƒ </span>
                </div>
            </div>
        </div>

        <!-- ãƒãƒ£ãƒƒãƒˆã‚³ãƒ³ãƒ†ãƒŠ -->
        <div class="chat-container">
            <!-- ãƒ¢ãƒ¼ãƒ‰é¸æŠ -->
            <div class="mode-selector">
                <button class="mode-btn active" data-mode="chat">ğŸ¤– çµ±åˆãƒãƒ£ãƒƒãƒˆ</button>
                <button class="mode-btn" data-mode="diagnostic">ğŸ” ç—‡çŠ¶è¨ºæ–­</button>
                <button class="mode-btn hidden" data-mode="repair_search">ğŸ› ï¸ ä¿®ç†æ¤œç´¢</button>
                <button class="mode-btn" data-mode="cost_estimate">ğŸ”§ ä¿®ç†ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚»ãƒ³ã‚¿ãƒ¼</button>
            </div>

            <!-- ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div class="quick-actions">
                <button class="quick-btn" onclick="sendQuickMessage('ãƒãƒƒãƒ†ãƒªãƒ¼ãŒä¸ŠãŒã‚Šã¾ã›ã‚“')">ãƒãƒƒãƒ†ãƒªãƒ¼ä¸ŠãŒã‚Š</button>
                <button class="quick-btn" onclick="sendQuickMessage('ãƒˆã‚¤ãƒ¬ãŒè©°ã¾ã‚Šã¾ã—ãŸ')">ãƒˆã‚¤ãƒ¬è©°ã¾ã‚Š</button>
                <button class="quick-btn" onclick="sendQuickMessage('ã‚¨ã‚¢ã‚³ãƒ³ãŒåŠ¹ãã¾ã›ã‚“')">ã‚¨ã‚¢ã‚³ãƒ³æ•…éšœ</button>
                <button class="quick-btn" onclick="sendQuickMessage('é›¨æ¼ã‚ŠãŒã—ã¾ã™')">é›¨æ¼ã‚Š</button>
                <button class="quick-btn" onclick="sendQuickMessage('ä¿®ç†è²»ç”¨ã‚’çŸ¥ã‚ŠãŸã„')">è²»ç”¨ç›¸è«‡</button>
            </div>

            <!-- ãƒãƒ£ãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
            <div class="chat-messages" id="chatMessages">
                <div class="message message-system">
                    ğŸ”§ ã‚­ãƒ£ãƒ³ãƒ”ãƒ³ã‚°ã‚«ãƒ¼ä¿®ç†ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆã«ã‚ˆã†ã“ãï¼<br>
                    ä¿®ç†ã«ã¤ã„ã¦ä½•ã§ã‚‚ãŠèããã ã•ã„ã€‚AIè¨ºæ–­ã€è©³ç´°æ¤œç´¢ã€è²»ç”¨ç›¸è«‡ãªã©ã€ã‚ã‚‰ã‚†ã‚‹æ©Ÿèƒ½ã‚’çµ±åˆã—ã¦ã„ã¾ã™ã€‚
                </div>
                
                <!-- é–¢é€£ãƒ–ãƒ­ã‚°ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
                <div class="message message-system" style="background: #f8f9fa; border-left: 4px solid #667eea; margin: 20px 0;">
                    <h3 style="color: #667eea; margin-bottom: 15px;">ğŸ“š é–¢é€£ãƒ–ãƒ­ã‚°</h3>
                    <p style="margin-bottom: 15px; color: #666;">ã‚ˆã‚Šè©³ã—ã„æƒ…å ±ã¯ä¿®ç†ãƒ–ãƒ­ã‚°ä¸€è¦§ã‚’ã”è¦§ãã ã•ã„ã€‚</p>
                    <div style="display: flex; flex-direction: column; gap: 10px;">
                        <a href="https://camper-repair.net/blog/repair1/" target="_blank" class="blog-link">
                            ğŸ”‹ ãƒãƒƒãƒ†ãƒªãƒ¼ãƒ»ãƒãƒƒãƒ†ãƒªãƒ¼ã®æ•…éšœã¨ä¿®ç†æ–¹æ³•
                        </a>
                        <a href="https://camper-repair.net/blog/risk1/" target="_blank" class="blog-link">
                            ğŸ› ï¸ åŸºæœ¬ä¿®ç†ãƒ»ã‚­ãƒ£ãƒ³ãƒ”ãƒ³ã‚°ã‚«ãƒ¼ä¿®ç†ã®åŸºæœ¬
                        </a>
                        <a href="https://camper-repair.net/battery-selection/" target="_blank" class="blog-link">
                            ğŸ” å®šæœŸç‚¹æ¤œãƒ»å®šæœŸç‚¹æ¤œã¨ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹
                        </a>
                    </div>
                </div>
            </div>

            <!-- è¨ºæ–­ãƒ•ãƒ­ãƒ¼ã‚³ãƒ³ãƒ†ãƒŠ -->
            <div class="diagnostic-flow-container" id="diagnosticFlowContainer">
                <!-- è¨ºæ–­é€²è¡ŒçŠ¶æ³ -->
                <div class="diagnostic-progress">
                    <div class="progress-header">
                        <span class="progress-text" id="progressText">è¨ºæ–­ã‚’é–‹å§‹ã—ã¦ã„ã¾ã™...</span>
                        <span id="progressStep">1/5</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                </div>

                <!-- ç·Šæ€¥è­¦å‘Š -->
                <div class="emergency-warning hidden" id="emergencyWarning">
                    <h4>ğŸš¨ ç·Šæ€¥è­¦å‘Š</h4>
                    <p id="emergencyText">å±é™ºãªç—‡çŠ¶ãŒæ¤œå‡ºã•ã‚Œã¾ã—ãŸã€‚ç›´ã¡ã«å®‰å…¨å¯¾ç­–ã‚’è¬›ã˜ã¦ãã ã•ã„ã€‚</p>
                </div>

                <!-- è¨ºæ–­è³ªå• -->
                <div class="diagnostic-question">
                    <h3>ğŸ” è¨ºæ–­è³ªå•</h3>
                    <p id="currentQuestion">ç—‡çŠ¶ã‚’è©³ã—ãæ•™ãˆã¦ãã ã•ã„</p>
                </div>

                <!-- é¸æŠè‚¢ -->
                <div class="diagnostic-options" id="diagnosticOptions">
                    <!-- é¸æŠè‚¢ãŒå‹•çš„ã«ç”Ÿæˆã•ã‚Œã‚‹ -->
                </div>

                <!-- è¨ºæ–­çµæœ -->
                <div class="diagnostic-result" id="diagnosticResult">
                    <div class="result-header">
                        <h3>ğŸ” è¨ºæ–­çµæœ</h3>
                        <div class="confidence-meter">
                            <span class="confidence-value" id="confidenceValue">85%</span>
                        </div>
                    </div>

                    <div class="result-content" id="resultContent">
                        <!-- è¨ºæ–­çµæœã®å†…å®¹ -->
                    </div>

                    <div class="related-cases">
                        <h4>ğŸ”§ é–¢é€£ä¿®ç†ã‚±ãƒ¼ã‚¹</h4>
                        <div id="relatedCasesContent">
                            <!-- Notionãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰ã®ã‚±ãƒ¼ã‚¹è¡¨ç¤º -->
                        </div>
                    </div>

                    <div class="required-parts">
                        <h4>ğŸ› ï¸ å¿…è¦ãªéƒ¨å“ãƒ»å·¥å…·</h4>
                        <div id="requiredPartsContent">
                            <!-- éƒ¨å“æƒ…å ±è¡¨ç¤º -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚° -->
            <div class="loading" id="loading">
                <div class="spinner"></div>
                AIãŒå›ç­”ã‚’ç”Ÿæˆä¸­...
            </div>

            <!-- å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ  -->
            <div class="input-container">
                <input type="text" class="chat-input" id="chatInput" placeholder="ä¿®ç†ã«ã¤ã„ã¦è³ªå•ã—ã¦ãã ã•ã„..." onkeypress="handleKeyPress(event)">
                <button class="send-btn" id="sendBtn" onclick="sendMessage()">é€ä¿¡</button>
            </div>

            <!-- ãƒ‡ãƒãƒƒã‚°ãƒ‘ãƒãƒ« -->
            <div class="debug-panel" id="debugPanel">
                <div class="debug-title">ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ±</div>
                <div class="debug-content" id="debugContent"></div>
            </div>
        </div>

        <!-- ãƒ•ãƒƒã‚¿ãƒ¼ -->
        <div class="footer">
            <p>Â© 2024 ã‚­ãƒ£ãƒ³ãƒ”ãƒ³ã‚°ã‚«ãƒ¼ä¿®ç†ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆ - çµ±åˆAIã‚·ã‚¹ãƒ†ãƒ </p>
        </div>
    </div>

    <script>
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        let currentMode = 'chat';
        let isProcessing = false;
        let debugMode = false;
        
        // è¨ºæ–­ãƒ•ãƒ­ãƒ¼ç”¨å¤‰æ•°
        let diagnosticSession = null;
        let diagnosticFlow = null;
        let currentDiagnosticNode = null;
        let diagnosticHistory = [];
        let conversationId = null;

        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            checkSystemStatus();
            setupEventListeners();
            startNewConversation();
            
            // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ¢ãƒ¼ãƒ‰ã‚’è¨­å®š
            setMode('chat');
            console.log('åˆæœŸåŒ–å®Œäº†ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ¢ãƒ¼ãƒ‰: chat');
        });

        // æ–°ã—ã„ä¼šè©±é–‹å§‹
        async function startNewConversation() {
            try {
                // ã¾ãšä¼šè©±ã‚’é–‹å§‹
                const response = await fetch('http://localhost:5002/start_conversation', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    conversationId = data.conversation_id;
                    console.log('æ–°ã—ã„ä¼šè©±ã‚’é–‹å§‹ã—ã¾ã—ãŸ:', conversationId);
                    
                    // ãƒãƒ£ãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ã‚¯ãƒªã‚¢
                    const chatMessages = document.getElementById('chatMessages');
                    if (chatMessages) {
                        chatMessages.innerHTML = '';
                        addMessage('ğŸ†• æ–°ã—ã„ä¼šè©±ã‚’é–‹å§‹ã—ã¾ã—ãŸã€‚ä½•ã§ã‚‚ãŠèããã ã•ã„ï¼', 'ai');
                    }
                    
                    // æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
                    showNotification('æ–°ã—ã„ä¼šè©±ã‚’é–‹å§‹ã—ã¾ã—ãŸã€‚APIã‚­ãƒ¼ãŒæ›´æ–°ã•ã‚Œã¾ã—ãŸã€‚', 'success');
                    
                    // ãƒ†ã‚¹ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã—ã¦APIã‚­ãƒ¼ã‚’ç¢ºèª
                    await testApiKey();
                } else {
                    console.error('æ–°ã—ã„ä¼šè©±é–‹å§‹ã‚¨ãƒ©ãƒ¼:', response.status);
                    showNotification('æ–°ã—ã„ä¼šè©±ã®é–‹å§‹ã«å¤±æ•—ã—ã¾ã—ãŸã€‚', 'error');
                }
            } catch (error) {
                console.error('æ–°ã—ã„ä¼šè©±é–‹å§‹ã‚¨ãƒ©ãƒ¼:', error);
                showNotification('æ–°ã—ã„ä¼šè©±ã®é–‹å§‹ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚', 'error');
            }
        }

        // APIã‚­ãƒ¼ãƒ†ã‚¹ãƒˆ
        async function testApiKey() {
            try {
                const testResponse = await fetch('http://localhost:5002/ask', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: new URLSearchParams({
                        question: 'APIã‚­ãƒ¼ã®ãƒ†ã‚¹ãƒˆ'
                    })
                });
                
                if (testResponse.ok) {
                    console.log('APIã‚­ãƒ¼ãƒ†ã‚¹ãƒˆæˆåŠŸ');
                    showNotification('APIã‚­ãƒ¼ãŒæ­£å¸¸ã«å‹•ä½œã—ã¦ã„ã¾ã™ï¼', 'success');
                } else {
                    const errorData = await testResponse.json();
                    console.error('APIã‚­ãƒ¼ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼:', errorData);
                    showNotification('APIã‚­ãƒ¼ã«å•é¡ŒãŒã‚ã‚Šã¾ã™ã€‚ç®¡ç†è€…ã«ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚', 'error');
                }
            } catch (error) {
                console.error('APIã‚­ãƒ¼ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼:', error);
                showNotification('APIã‚­ãƒ¼ãƒ†ã‚¹ãƒˆä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚', 'error');
            }
        }

        // é€šçŸ¥è¡¨ç¤ºï¼ˆéè¡¨ç¤ºåŒ–ï¼‰
        function showNotification(message, type = 'info') {
            // é€šçŸ¥ã‚’éè¡¨ç¤ºã«ã™ã‚‹ãŸã‚ã€ä½•ã‚‚ã—ãªã„
            return;
        }

        // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã®è¨­å®š
        function setupEventListeners() {
            // ãƒ¢ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆ
            document.querySelectorAll('.mode-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    console.log('ãƒ¢ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚Œã¾ã—ãŸ:', this.dataset.mode);
                    setMode(this.dataset.mode);
                });
            });
            
            // ãƒ‡ãƒãƒƒã‚°ç”¨: ãƒ¢ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³ã®çŠ¶æ…‹ã‚’ç¢ºèª
            console.log('ãƒ¢ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³ã®æ•°:', document.querySelectorAll('.mode-btn').length);
            document.querySelectorAll('.mode-btn').forEach((btn, index) => {
                console.log(`ãƒœã‚¿ãƒ³ ${index}:`, btn.textContent, 'data-mode:', btn.dataset.mode);
            });
        }

        // ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹ã®ç¢ºèª
        async function checkSystemStatus() {
            try {
                const response = await fetch('http://localhost:5002/api/unified/health');
                if (response.ok) {
                    const data = await response.json();
                    updateStatusIndicators(data.services);
                } else {
                    updateStatusIndicators({});
                }
            } catch (error) {
                console.error('ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹ç¢ºèªã‚¨ãƒ©ãƒ¼:', error);
                updateStatusIndicators({});
            }
        }

        // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ã®æ›´æ–°
        function updateStatusIndicators(services) {
            const apiStatus = document.getElementById('apiStatus');
            const aiStatus = document.getElementById('aiStatus');
            const ragStatus = document.getElementById('ragStatus');

            // APIçŠ¶æ…‹
            apiStatus.className = 'status-indicator ' + (services.rag_system ? 'status-online' : 'status-offline');
            
            // AIçŠ¶æ…‹
            aiStatus.className = 'status-indicator ' + (services.openai_api ? 'status-online' : 'status-offline');
            
            // RAGçŠ¶æ…‹
            ragStatus.className = 'status-indicator ' + (services.rag_system ? 'status-online' : 'status-warning');
        }

        // ãƒ¢ãƒ¼ãƒ‰è¨­å®š
        function setMode(mode) {
            currentMode = mode;
            console.log('ãƒ¢ãƒ¼ãƒ‰ã‚’å¤‰æ›´:', mode);
            
            // ãƒœã‚¿ãƒ³ã®çŠ¶æ…‹æ›´æ–°
            document.querySelectorAll('.mode-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-mode="${mode}"]`).classList.add('active');
            
            // ãƒ¢ãƒ¼ãƒ‰ã«å¿œã˜ãŸå‡¦ç†
            switch(mode) {
                case 'chat':
                    updateChatMode();
                    break;
                case 'diagnostic':
                    updateDiagnosticMode();
                    break;
                case 'repair_search':
                    updateRepairSearchMode();
                    break;
                case 'cost_estimate':
                    updateCostEstimateMode();
                    break;
                default:
                    console.log('æœªçŸ¥ã®ãƒ¢ãƒ¼ãƒ‰:', mode);
            }
        }

        // ãƒãƒ£ãƒƒãƒˆãƒ¢ãƒ¼ãƒ‰ã®æ›´æ–°
        function updateChatMode() {
            const chatInput = document.getElementById('chatInput');
            if (chatInput) {
                chatInput.placeholder = 'ä¿®ç†ã«ã¤ã„ã¦è³ªå•ã—ã¦ãã ã•ã„...';
            }
            console.log('ãƒãƒ£ãƒƒãƒˆãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆ');
            
            // è¨ºæ–­ãƒ•ãƒ­ãƒ¼ã‚³ãƒ³ãƒ†ãƒŠã‚’éè¡¨ç¤º
            hideDiagnosticFlow();
        }

        // è¨ºæ–­ãƒ•ãƒ­ãƒ¼ã‚’éè¡¨ç¤º
        function hideDiagnosticFlow() {
            const diagnosticContainer = document.getElementById('diagnosticFlowContainer');
            if (diagnosticContainer) {
                diagnosticContainer.classList.remove('active');
            }
        }

        // è¨ºæ–­ãƒ¢ãƒ¼ãƒ‰ã®æ›´æ–°
        function updateDiagnosticMode() {
            const chatInput = document.getElementById('chatInput');
            if (chatInput) {
                chatInput.placeholder = 'ç—‡çŠ¶ã‚’è©³ã—ãæ•™ãˆã¦ãã ã•ã„ï¼ˆä¾‹ï¼šã‚¨ã‚¢ã‚³ãƒ³ãŒåŠ¹ã‹ãªã„ã€ç•°éŸ³ãŒã™ã‚‹ï¼‰...';
            }
            console.log('è¨ºæ–­ãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆ');
            
            // è¨ºæ–­ãƒ•ãƒ­ãƒ¼ã‚³ãƒ³ãƒ†ãƒŠã‚’è¡¨ç¤º
            showDiagnosticFlow();
            
            // è¨ºæ–­ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’é–‹å§‹
            startDiagnosticSession();
        }

        // è¨ºæ–­ãƒ•ãƒ­ãƒ¼ã‚’è¡¨ç¤º
        function showDiagnosticFlow() {
            const diagnosticContainer = document.getElementById('diagnosticFlowContainer');
            if (diagnosticContainer) {
                diagnosticContainer.classList.add('active');
                diagnosticContainer.scrollIntoView({ behavior: 'smooth' });
            }
        }

        // è¨ºæ–­ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’é–‹å§‹
        async function startDiagnosticSession() {
            try {
                console.log('ğŸ” è¨ºæ–­ã‚»ãƒƒã‚·ãƒ§ãƒ³é–‹å§‹');
                
                // è¨ºæ–­é–‹å§‹APIã‚’å‘¼ã³å‡ºã—
                const response = await fetch('/chat/diagnose/start', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        category: getSelectedCategory(),
                        user_input: "æ°´é“ãƒãƒ³ãƒ—ã‹ã‚‰ç•°éŸ³ãŒã™ã‚‹" // ãƒ†ã‚¹ãƒˆç”¨ã®åˆæœŸå…¥åŠ›
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                console.log('è¨ºæ–­é–‹å§‹ãƒ¬ã‚¹ãƒãƒ³ã‚¹:', data);

                if (data.session_id) {
                    diagnosticSession = data.session_id;
                    currentDiagnosticNode = data.node_id;
                    diagnosticHistory = [data.node_id];
                    
                    // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯è¨ºæ–­ã®å ´åˆã¯ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
                    if (data.fallback) {
                        addMessage('ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯è¨ºæ–­ãƒ¢ãƒ¼ãƒ‰ã§é–‹å§‹ã—ã¾ã—ãŸã€‚åŸºæœ¬çš„ãªè¨ºæ–­ã‚’è¡Œã„ã¾ã™ã€‚', 'ai');
                    }
                    
                    // è¨ºæ–­è³ªå•ã‚’è¡¨ç¤º
                    displayDiagnosticQuestion(data);
                    
                    // ç·Šæ€¥è­¦å‘ŠãŒã‚ã‚Œã°è¡¨ç¤º
                    if (data.safety && data.safety.urgent) {
                        showEmergencyWarning(data.safety.notes);
                    }
                } else {
                    throw new Error('è¨ºæ–­ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®é–‹å§‹ã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
            } catch (error) {
                console.error('è¨ºæ–­ã‚»ãƒƒã‚·ãƒ§ãƒ³é–‹å§‹ã‚¨ãƒ©ãƒ¼:', error);
                console.error('ã‚¨ãƒ©ãƒ¼è©³ç´°:', error.message);
                console.error('ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹:', response?.status);
                console.error('ãƒ¬ã‚¹ãƒãƒ³ã‚¹å†…å®¹:', data);
                
                // ã‚ˆã‚Šè©³ç´°ãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
                let errorMessage = 'è¨ºæ–­ã‚·ã‚¹ãƒ†ãƒ ã®åˆæœŸåŒ–ã«å¤±æ•—ã—ã¾ã—ãŸã€‚';
                if (error.message.includes('fetch')) {
                    errorMessage += ' ã‚µãƒ¼ãƒãƒ¼ã«æ¥ç¶šã§ãã¾ã›ã‚“ã€‚';
                } else if (error.message.includes('JSON')) {
                    errorMessage += ' ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®è§£æã«å¤±æ•—ã—ã¾ã—ãŸã€‚';
                } else {
                    errorMessage += ` ã‚¨ãƒ©ãƒ¼: ${error.message}`;
                }
                errorMessage += ' é€šå¸¸ã®ãƒãƒ£ãƒƒãƒˆãƒ¢ãƒ¼ãƒ‰ã‚’ã”åˆ©ç”¨ãã ã•ã„ã€‚';
                
                addMessage(errorMessage, 'ai');
            }
        }

        // è¨ºæ–­è³ªå•ã‚’è¡¨ç¤º
        function displayDiagnosticQuestion(data) {
            const questionElement = document.getElementById('currentQuestion');
            const progressElement = document.getElementById('progressText');
            
            if (questionElement) {
                questionElement.textContent = data.question || 'ç—‡çŠ¶ã‚’è©³ã—ãæ•™ãˆã¦ãã ã•ã„';
            }
            
            if (progressElement) {
                progressElement.textContent = 'è¨ºæ–­é€²è¡Œä¸­...';
            }
            
            // é¸æŠè‚¢ã‚’è¡¨ç¤º
            displayDiagnosticOptions(data.options || []);
        }

        // è¨ºæ–­é¸æŠè‚¢ã‚’è¡¨ç¤º
        function displayDiagnosticOptions(options) {
            const optionsContainer = document.getElementById('diagnosticOptions');
            if (!optionsContainer) return;
            
            optionsContainer.innerHTML = '';
            
            if (options.length === 0) {
                // é¸æŠè‚¢ãŒãªã„å ´åˆã¯è‡ªç”±å…¥åŠ›
                optionsContainer.innerHTML = `
                    <div class="option-btn" onclick="submitDiagnosticAnswer('')">
                        è‡ªç”±è¨˜è¿°ã§å›ç­”ã™ã‚‹
                    </div>
                `;
            } else {
                options.forEach((option, index) => {
                    const optionBtn = document.createElement('div');
                    optionBtn.className = 'option-btn';
                    optionBtn.textContent = option.text || option;
                    optionBtn.onclick = () => submitDiagnosticAnswer(option.text || option);
                    optionsContainer.appendChild(optionBtn);
                });
            }
        }

        // è¨ºæ–­å›ç­”ã‚’é€ä¿¡
        async function submitDiagnosticAnswer(answer) {
            if (!diagnosticSession || !currentDiagnosticNode) {
                console.error('è¨ºæ–­ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒç„¡åŠ¹ã§ã™');
                return;
            }

            try {
                console.log('ğŸ” è¨ºæ–­å›ç­”é€ä¿¡:', answer);
                
                // é¸æŠã•ã‚ŒãŸãƒœã‚¿ãƒ³ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆ
                const selectedBtn = event.target;
                if (selectedBtn) {
                    selectedBtn.classList.add('selected');
                    setTimeout(() => selectedBtn.classList.remove('selected'), 1000);
                }
                
                // è¨ºæ–­å›ç­”APIã‚’å‘¼ã³å‡ºã—
                const response = await fetch('/chat/diagnose/answer', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        session_id: diagnosticSession,
                        node_id: currentDiagnosticNode,
                        answer_text: answer
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                console.log('è¨ºæ–­å›ç­”ãƒ¬ã‚¹ãƒãƒ³ã‚¹:', data);

                if (data.is_terminated) {
                    // è¨ºæ–­çµ‚äº†
                    displayDiagnosticResult(data);
                } else {
                    // æ¬¡ã®è³ªå•ã¸
                    currentDiagnosticNode = data.node_id;
                    diagnosticHistory.push(data.node_id);
                    displayDiagnosticQuestion(data);
                    updateProgress();
                }
            } catch (error) {
                console.error('è¨ºæ–­å›ç­”ã‚¨ãƒ©ãƒ¼:', error);
                addMessage('è¨ºæ–­å‡¦ç†ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚', 'ai');
            }
        }

        // è¨ºæ–­çµæœã‚’è¡¨ç¤º
        function displayDiagnosticResult(data) {
            console.log('ğŸ” è¨ºæ–­çµæœè¡¨ç¤º:', data);
            
            // é€²æ—ã‚’100%ã«
            const progressFill = document.getElementById('progressFill');
            if (progressFill) {
                progressFill.style.width = '100%';
            }
            
            const progressText = document.getElementById('progressText');
            if (progressText) {
                progressText.textContent = 'è¨ºæ–­å®Œäº†';
            }
            
            // è³ªå•ã‚¨ãƒªã‚¢ã‚’éè¡¨ç¤º
            const questionArea = document.querySelector('.diagnostic-question');
            const optionsArea = document.getElementById('diagnosticOptions');
            if (questionArea) questionArea.style.display = 'none';
            if (optionsArea) optionsArea.style.display = 'none';
            
            // è¨ºæ–­çµæœã‚’è¡¨ç¤º
            const resultContainer = document.getElementById('diagnosticResult');
            if (resultContainer) {
                resultContainer.classList.add('active');
                
                // ç¢ºä¿¡åº¦ã‚’è¡¨ç¤º
                const confidenceElement = document.getElementById('confidenceValue');
                if (confidenceElement && data.confidence) {
                    confidenceElement.textContent = `${Math.round(data.confidence * 100)}%`;
                }
                
                // è¨ºæ–­çµæœå†…å®¹ã‚’è¡¨ç¤º
                const resultContent = document.getElementById('resultContent');
                if (resultContent && data.summary) {
                    resultContent.innerHTML = `
                        <div class="case-item">
                            <div class="case-title">${data.summary.title || 'è¨ºæ–­çµæœ'}</div>
                            <div class="case-description">${data.summary.details || data.summary.next_steps || ''}</div>
                        </div>
                    `;
                }
                
                // é–¢é€£ã‚±ãƒ¼ã‚¹ã‚’è¡¨ç¤º
                if (data.related_cases && data.related_cases.length > 0) {
                    displayRelatedCases(data.related_cases);
                }
                
                // å¿…è¦ãªéƒ¨å“ã‚’è¡¨ç¤º
                if (data.required_parts && data.required_parts.length > 0) {
                    displayRequiredParts(data.required_parts);
                }
            }
        }

        // é–¢é€£ã‚±ãƒ¼ã‚¹ã‚’è¡¨ç¤º
        function displayRelatedCases(cases) {
            const casesContainer = document.getElementById('relatedCasesContent');
            if (!casesContainer) return;
            
            casesContainer.innerHTML = '';
            
            cases.forEach(caseItem => {
                const caseElement = document.createElement('div');
                caseElement.className = 'case-item';
                
                const caseTitle = caseItem.title || caseItem.case_id || 'ä¿®ç†ã‚±ãƒ¼ã‚¹';
                const caseDescription = caseItem.description || caseItem.solution || '';
                const caseUrl = caseItem.url || '';
                
                caseElement.innerHTML = `
                    <div class="case-title">${caseTitle}</div>
                    <div class="case-description">${caseDescription}</div>
                    ${caseUrl ? `<div class="case-url"><a href="${caseUrl}" target="_blank">è©³ç´°ã‚’è¦‹ã‚‹</a></div>` : ''}
                `;
                
                casesContainer.appendChild(caseElement);
            });
        }

        // å¿…è¦ãªéƒ¨å“ã‚’è¡¨ç¤º
        function displayRequiredParts(parts) {
            const partsContainer = document.getElementById('requiredPartsContent');
            if (!partsContainer) return;
            
            partsContainer.innerHTML = '';
            
            parts.forEach(part => {
                const partElement = document.createElement('div');
                partElement.className = 'part-item';
                
                const partName = part.name || part.title || 'éƒ¨å“';
                const partInfo = part.description || part.info || '';
                const partPrice = part.price || '';
                
                partElement.innerHTML = `
                    <div class="part-name">${partName}</div>
                    <div class="part-info">${partInfo}</div>
                    ${partPrice ? `<div class="part-price">å‚è€ƒä¾¡æ ¼: ${partPrice}</div>` : ''}
                `;
                
                partsContainer.appendChild(partElement);
            });
        }

        // ç·Šæ€¥è­¦å‘Šã‚’è¡¨ç¤º
        function showEmergencyWarning(message) {
            const warningElement = document.getElementById('emergencyWarning');
            const warningText = document.getElementById('emergencyText');
            
            if (warningElement && warningText) {
                warningText.textContent = message;
                warningElement.classList.remove('hidden');
                warningElement.scrollIntoView({ behavior: 'smooth' });
            }
        }

        // é€²æ—ã‚’æ›´æ–°
        function updateProgress() {
            const progressFill = document.getElementById('progressFill');
            const progressStep = document.getElementById('progressStep');
            
            if (progressFill && diagnosticHistory.length > 0) {
                const progress = Math.min((diagnosticHistory.length / 5) * 100, 90); // æœ€å¤§90%ã¾ã§
                progressFill.style.width = `${progress}%`;
            }
            
            if (progressStep) {
                progressStep.textContent = `${diagnosticHistory.length}/5`;
            }
        }

        // é¸æŠã•ã‚ŒãŸã‚«ãƒ†ã‚´ãƒªã‚’å–å¾—
        function getSelectedCategory() {
            // ç¾åœ¨ã®ãƒ¢ãƒ¼ãƒ‰ã‚„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®é¸æŠã«åŸºã¥ã„ã¦ã‚«ãƒ†ã‚´ãƒªã‚’æ±ºå®š
            // ç°¡æ˜“å®Ÿè£…ã¨ã—ã¦ã€è¨ºæ–­ãƒ¢ãƒ¼ãƒ‰ã§ã¯ä¸€èˆ¬çš„ãªã‚«ãƒ†ã‚´ãƒªã‚’è¿”ã™
            return 'general';
        }

        // ä¿®ç†æ¤œç´¢ãƒ¢ãƒ¼ãƒ‰ã®æ›´æ–°
        function updateRepairSearchMode() {
            const chatInput = document.getElementById('chatInput');
            if (chatInput) {
                chatInput.placeholder = 'ä¿®ç†ã—ãŸã„éƒ¨å“ã‚„ç—‡çŠ¶ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„...';
            }
            console.log('ä¿®ç†æ¤œç´¢ãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆ');
        }

        // ä¿®ç†ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚»ãƒ³ã‚¿ãƒ¼ã®æ›´æ–°
        function updateCostEstimateMode() {
            console.log('ä¿®ç†ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚»ãƒ³ã‚¿ãƒ¼ã«åˆ‡ã‚Šæ›¿ãˆ - ä¿®ç†ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚»ãƒ³ã‚¿ãƒ¼ã«é·ç§»ã—ã¾ã™');
            
            // ä¿®ç†ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚»ãƒ³ã‚¿ãƒ¼ã«é·ç§»
            window.location.href = '/repair_advice_center.html';
        }

        // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡
        async function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message || isProcessing) return;
            
            // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
            addMessage(message, 'user');
            input.value = '';
            
            // å‡¦ç†é–‹å§‹
            setProcessing(true);
            
            // ãƒ¢ãƒ¼ãƒ‰ã«å¿œã˜ãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®å‰å‡¦ç†
            let processedMessage = message;
            if (currentMode === 'cost_estimate') {
                // ä¿®ç†ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚»ãƒ³ã‚¿ãƒ¼ã®å ´åˆã¯ã€ä¿®ç†ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚»ãƒ³ã‚¿ãƒ¼ã«èª˜å°
                addMessage(`
                    <div style="background: linear-gradient(135deg, #28a745, #20c997); color: white; padding: 20px; border-radius: 15px; margin: 10px 0; text-align: center;">
                        <h3 style="margin: 0 0 15px 0; font-size: 1.3rem;">ğŸ”§ ä¿®ç†ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚»ãƒ³ã‚¿ãƒ¼</h3>
                        <p style="margin: 0 0 15px 0; font-size: 1.1rem;">ã€Œ${message}ã€ã«ã¤ã„ã¦</p>
                        <p style="margin: 0 0 15px 0; font-size: 1rem;">è©³ç´°ãªä¾¡æ ¼æƒ…å ±ã¨å•†å“ãƒ‡ãƒ¼ã‚¿ã‚’ç¢ºèªã™ã‚‹ã«ã¯ã€ä¿®ç†ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚»ãƒ³ã‚¿ãƒ¼ã‚’ã”åˆ©ç”¨ãã ã•ã„ã€‚</p>
                        <button onclick="openRepairAdviceCenter()" style="
                            background: white; 
                            color: #28a745; 
                            border: none; 
                            padding: 12px 24px; 
                            border-radius: 25px; 
                            font-weight: bold; 
                            font-size: 1rem; 
                            cursor: pointer; 
                            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
                            transition: all 0.3s ease;
                        " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(0,0,0,0.3)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(0,0,0,0.2)'">
                            ğŸš€ ä¿®ç†ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚»ãƒ³ã‚¿ãƒ¼ã§è©³ç´°ã‚’ç¢ºèª
                        </button>
                    </div>
                `, 'ai');
                setProcessing(false);
                return;
            } else if (currentMode === 'diagnostic') {
                processedMessage = `ç—‡çŠ¶è¨ºæ–­: ${message}`;
                
                // è¨ºæ–­ãƒ¢ãƒ¼ãƒ‰ã§ã¯è¿½åŠ ã®è¨ºæ–­æƒ…å ±ã‚’æä¾›
                setTimeout(() => {
                    addMessage(`
                        <div style="background: #e3f2fd; border-left: 4px solid #2196f3; padding: 15px; margin: 10px 0; border-radius: 8px;">
                            <h4 style="margin: 0 0 10px 0; color: #1976d2;">ğŸ” è¨ºæ–­ã‚’é€²ã‚ã‚‹ãŸã‚ã«</h4>
                            <p style="margin: 0 0 10px 0; color: #424242;">
                                ã‚ˆã‚Šè©³ç´°ãªè¨ºæ–­ã‚’è¡Œã†ãŸã‚ã«ã€ä»¥ä¸‹ã®ç‚¹ã«ã¤ã„ã¦ã‚‚æ•™ãˆã¦ãã ã•ã„ï¼š
                            </p>
                            <ul style="margin: 0; color: #424242; padding-left: 20px;">
                                <li>ç—‡çŠ¶ãŒç™ºç”Ÿã™ã‚‹æ¡ä»¶ï¼ˆã‚¨ãƒ³ã‚¸ãƒ³å§‹å‹•æ™‚ã€èµ°è¡Œä¸­ã€åœè»Šæ™‚ãªã©ï¼‰</li>
                                <li>ç•°å¸¸éŸ³ã‚„æŒ¯å‹•ã®æœ‰ç„¡</li>
                                <li>è­¦å‘Šç¯ã®ç‚¹ç¯çŠ¶æ³</li>
                                <li>æœ€è¿‘ã®ä¿®ç†ãƒ»äº¤æ›å±¥æ­´</li>
                            </ul>
                            <p style="margin: 10px 0 0 0; color: #1976d2; font-size: 0.9rem;">
                                ğŸ’¡ è©³ç´°ãªè¨ºæ–­ã«ã¯ä¿®ç†ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚»ãƒ³ã‚¿ãƒ¼ã‚‚ã”åˆ©ç”¨ãã ã•ã„
                            </p>
                        </div>
                    `, 'ai');
                }, 2000);
            } else if (currentMode === 'repair_search') {
                processedMessage = `ä¿®ç†æ¤œç´¢: ${message}`;
            }
            
            try {
                const response = await fetch('http://localhost:5002/ask', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: new URLSearchParams({
                        question: processedMessage
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    displayResponse(data);
                } else {
                    const error = await response.json();
                    addMessage(`âŒ ã‚¨ãƒ©ãƒ¼: ${error.error}`, 'ai');
                }
            } catch (error) {
                addMessage(`âŒ æ¥ç¶šã‚¨ãƒ©ãƒ¼: ${error.message}`, 'ai');
            } finally {
                setProcessing(false);
            }
        }

        // ã‚¯ã‚¤ãƒƒã‚¯ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡
        function sendQuickMessage(message) {
            document.getElementById('chatInput').value = message;
            sendMessage();
        }

        // ãƒ¬ã‚¹ãƒãƒ³ã‚¹è¡¨ç¤º
        function displayResponse(data) {
            if (data.error) {
                addMessage(`âŒ ã‚¨ãƒ©ãƒ¼: ${data.error}`, 'ai');
                return;
            }
            
            let responseText = '';
            
            if (data.answer) {
                responseText = data.answer;
            } else if (data.type === 'chat') {
                responseText = data.response;
            } else if (data.type === 'diagnostic') {
                responseText = formatDiagnosticResponse(data);
            } else if (data.type === 'repair_search') {
                responseText = formatRepairSearchResponse(data);
            } else if (data.type === 'cost_estimate') {
                responseText = formatCostEstimateResponse(data);
            }
            
            addMessage(responseText, 'ai');
            
            // ãƒ‡ãƒãƒƒã‚°æƒ…å ±ã®è¡¨ç¤ºï¼ˆéè¡¨ç¤ºï¼‰
            // if (debugMode) {
            //     showDebugInfo(data);
            // }
        }

        // è¨ºæ–­ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
        function formatDiagnosticResponse(data) {
            let response = '';
            
            if (data.type === 'notion_diagnostic') {
                // Notionè¨ºæ–­ãƒ•ãƒ­ãƒ¼ã®çµæœ
                response += 'ğŸ” **Notionè¨ºæ–­ãƒ•ãƒ­ãƒ¼**\n\n';
                
                if (data.current_node) {
                    const node = data.current_node;
                    response += `**è¨ºæ–­ãƒãƒ¼ãƒ‰:** ${node.title || 'Unknown'}\n`;
                    response += `**ã‚«ãƒ†ã‚´ãƒª:** ${node.category || 'N/A'}\n\n`;
                    
                    if (node.symptoms && node.symptoms.length > 0) {
                        response += `**é–¢é€£ç—‡çŠ¶:**\n`;
                        node.symptoms.forEach(symptom => {
                            response += `â€¢ ${symptom}\n`;
                        });
                        response += '\n';
                    }
                }
                
                if (data.related_cases && data.related_cases.length > 0) {
                    response += `**é–¢é€£ä¿®ç†ã‚±ãƒ¼ã‚¹:**\n`;
                    data.related_cases.slice(0, 3).forEach(case_item => {
                        response += `â€¢ ${case_item.title || 'Unknown Case'}\n`;
                        if (case_item.solution) {
                            response += `  - ${case_item.solution.substring(0, 100)}...\n`;
                        }
                    });
                    response += '\n';
                }
                
                response += `**è¨ºæ–­ä¿¡é ¼åº¦:** ${Math.round((data.confidence || 0) * 100)}%\n`;
                
            } else if (data.diagnosis) {
                // AIè¨ºæ–­ã®çµæœ
                response += 'ğŸ” **AIè¨ºæ–­çµæœ**\n\n';
                
                response += `**å¯èƒ½æ€§ã®ã‚ã‚‹åŸå› :**\n`;
                data.diagnosis.possible_causes.forEach(cause => {
                    response += `â€¢ ${cause}\n`;
                });
                
                response += `\n**æ¨å¥¨å¯¾å‡¦æ³•:**\n`;
                data.diagnosis.recommended_actions.forEach(action => {
                    response += `â€¢ ${action}\n`;
                });
                
                response += `\n**ç·Šæ€¥åº¦:** ${data.diagnosis.urgency}\n`;
                response += `**ä¿¡é ¼åº¦:** ${Math.round(data.diagnosis.confidence * 100)}%\n`;
                
                if (data.fallback) {
                    response += `\nâš ï¸ **æ³¨æ„:** Notionè¨ºæ–­ãŒåˆ©ç”¨ã§ããªã„ãŸã‚ã€AIè¨ºæ–­ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚\n`;
                }
            }
            
            return response;
        }

        // ä¿®ç†æ¤œç´¢ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
        function formatRepairSearchResponse(data) {
            let response = 'ğŸ› ï¸ **ä¿®ç†æ¤œç´¢çµæœ**\n\n';
            
            if (data.repair_info && data.repair_info.category) {
                response += `**ã‚«ãƒ†ã‚´ãƒª:** ${data.repair_info.category}\n`;
                response += `**ã‚¢ã‚¤ã‚³ãƒ³:** ${data.repair_info.icon}\n\n`;
                
                if (data.repair_info.repair_costs) {
                    response += `**ä¿®ç†è²»ç”¨:**\n${data.repair_info.repair_costs}\n\n`;
                }
                
                if (data.repair_info.repair_steps) {
                    response += `**ä¿®ç†æ‰‹é †:**\n${data.repair_info.repair_steps}\n\n`;
                }
                
                if (data.repair_info.warnings) {
                    response += `**æ³¨æ„äº‹é …:**\n${data.repair_info.warnings}\n\n`;
                }
            }
            
            return response;
        }

        // è²»ç”¨è¦‹ç©ã‚‚ã‚Šãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
        function formatCostEstimateResponse(data) {
            let response = 'ğŸ’° **è²»ç”¨è¦‹ç©ã‚‚ã‚Š**\n\n';
            
            if (data.category) {
                response += `**ã‚«ãƒ†ã‚´ãƒª:** ${data.category}\n\n`;
            }
            
            if (data.cost_info) {
                response += `**è²»ç”¨æƒ…å ±:**\n${data.cost_info}\n\n`;
            }
            
            if (data.price_results && data.price_results.results) {
                response += `**ä¾¡æ ¼æƒ…å ±:**\n`;
                data.price_results.results.forEach((item, index) => {
                    response += `${index + 1}. ${item.title}\n`;
                    if (item.price_info && item.price_info.price) {
                        response += `   ä¾¡æ ¼: ${item.price_info.price}å††\n`;
                    }
                    response += `   URL: ${item.url}\n\n`;
                });
            }
            
            return response;
        }

        // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¿½åŠ 
        function addMessage(content, type) {
            const messagesContainer = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message message-${type}`;
            messageDiv.innerHTML = formatMessageContent(content);
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
        function formatMessageContent(content) {
            console.log('å…ƒã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„:', content);
            
            // ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³é¢¨ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
            let formatted = content
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\*(.*?)\*/g, '<em>$1</em>')
                .replace(/\n/g, '<br>');
            
            console.log('ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³å¤‰æ›å¾Œ:', formatted);
            
            // ãƒ–ãƒ­ã‚°ãƒªãƒ³ã‚¯ã®è¡¨ç¤ºã‚’æ”¹å–„
            formatted = formatBlogLinks(formatted);
            
            console.log('ãƒ–ãƒ­ã‚°ãƒªãƒ³ã‚¯å¤‰æ›å¾Œ:', formatted);
            
            // URLã‚’ã‚¯ãƒªãƒƒã‚¯å¯èƒ½ãªãƒªãƒ³ã‚¯ã«å¤‰æ›
            formatted = convertUrlsToLinks(formatted);
            
            console.log('æœ€çµ‚çš„ãªãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ:', formatted);
            
            return formatted;
        }

        // URLã‚’ã‚¯ãƒªãƒƒã‚¯å¯èƒ½ãªãƒªãƒ³ã‚¯ã«å¤‰æ›
        function convertUrlsToLinks(text) {
            // ã‚ˆã‚Šç°¡å˜ã§ç¢ºå®ŸãªURLæ¤œå‡º
            const urlPattern = /(https?:\/\/[^\s]+)/g;
            return text.replace(urlPattern, function(url) {
                // URLãŒæ—¢ã«ãƒªãƒ³ã‚¯ã‚¿ã‚°ã§å›²ã¾ã‚Œã¦ã„ã‚‹å ´åˆã¯ã‚¹ã‚­ãƒƒãƒ—
                if (text.includes(`<a href="${url}">`)) {
                    return url;
                }
                console.log('URLã‚’æ¤œå‡º:', url);
                return `<a href="${url}" target="_blank" rel="noopener noreferrer" style="color: #667eea; text-decoration: underline; font-weight: bold; cursor: pointer;">${url}</a>`;
            });
        }

        // ãƒ–ãƒ­ã‚°è¨˜äº‹ã®è¡¨ç¤ºã‚’æ”¹å–„
        function formatBlogLinks(content) {
            // ãƒ–ãƒ­ã‚°è¨˜äº‹ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æ¤œå‡ºã—ã¦æ”¹å–„ï¼ˆã‚ˆã‚ŠæŸ”è»Ÿãªãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰
            const blogPattern = /â€¢\s*([^:]+):\s*(https?:\/\/[^\s<>"{}|\\^`[\]]+)/g;
            return content.replace(blogPattern, function(match, title, url) {
                return `<div class="blog-link-item" style="margin: 10px 0; padding: 10px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #667eea; cursor: pointer;" onclick="window.open('${url}', '_blank')">
                    <div class="blog-title" style="font-weight: bold; color: #333; margin-bottom: 5px;">${title}</div>
                    <div style="color: #667eea; font-size: 0.9rem; text-decoration: underline;">
                        ğŸ”— ${url}
                    </div>
                </div>`;
            });
        }

        // å‡¦ç†çŠ¶æ…‹ã®è¨­å®š
        function setProcessing(processing) {
            isProcessing = processing;
            const loading = document.getElementById('loading');
            const sendBtn = document.getElementById('sendBtn');
            
            if (processing) {
                loading.classList.add('show');
                sendBtn.disabled = true;
                sendBtn.textContent = 'å‡¦ç†ä¸­...';
            } else {
                loading.classList.remove('show');
                sendBtn.disabled = false;
                sendBtn.textContent = 'é€ä¿¡';
            }
        }

        // ã‚­ãƒ¼å…¥åŠ›å‡¦ç†
        function handleKeyPress(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        }

        // ãƒ‡ãƒãƒƒã‚°æƒ…å ±ã®è¡¨ç¤º
        function showDebugInfo(data) {
            const debugContent = document.getElementById('debugContent');
            debugContent.textContent = JSON.stringify(data, null, 2);
        }

        // ãƒ‡ãƒãƒƒã‚°æƒ…å ±ã‚’å–å¾—
        async function fetchDebugInfo() {
            try {
                const response = await fetch('http://localhost:5002/api/unified/debug');
                if (response.ok) {
                    const debugData = await response.json();
                    displayDebugInfo(debugData);
                } else {
                    console.error('ãƒ‡ãƒãƒƒã‚°æƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
            } catch (error) {
                console.error('ãƒ‡ãƒãƒƒã‚°æƒ…å ±å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
            }
        }

        // ãƒ‡ãƒãƒƒã‚°æƒ…å ±ã‚’è¡¨ç¤º
        function displayDebugInfo(data) {
            const debugContent = document.getElementById('debugContent');
            let html = '<div style="font-family: Arial, sans-serif;">';
            
            // ç’°å¢ƒå¤‰æ•°ãƒã‚§ãƒƒã‚¯
            html += '<h3 style="color: #667eea; margin-bottom: 10px;">ğŸ”§ ç’°å¢ƒå¤‰æ•°ãƒã‚§ãƒƒã‚¯</h3>';
            html += '<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px;">';
            for (const [key, value] of Object.entries(data.environment_variables)) {
                const color = value.includes('âœ…') ? '#28a745' : '#dc3545';
                html += `<div style="padding: 5px; border: 1px solid #dee2e6; border-radius: 5px;"><strong>${key}:</strong> <span style="color: ${color}">${value}</span></div>`;
            }
            html += '</div>';
            
            // APIã‚­ãƒ¼æƒ…å ±
            html += '<h3 style="color: #667eea; margin-bottom: 10px;">ğŸ”‘ APIã‚­ãƒ¼æƒ…å ±</h3>';
            html += '<div style="margin-bottom: 20px;">';
            for (const [key, value] of Object.entries(data.api_keys)) {
                if (value) {
                    html += `<div style="padding: 5px; background: #f8f9fa; border-radius: 5px; margin-bottom: 5px;"><strong>${key}:</strong> ${value}</div>`;
                }
            }
            html += '</div>';
            
            // ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ID
            html += '<h3 style="color: #667eea; margin-bottom: 10px;">ğŸ—„ï¸ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ID</h3>';
            html += '<div style="margin-bottom: 20px;">';
            for (const [key, value] of Object.entries(data.database_ids)) {
                const color = value ? '#28a745' : '#dc3545';
                html += `<div style="padding: 5px; background: #f8f9fa; border-radius: 5px; margin-bottom: 5px;"><strong>${key}:</strong> <span style="color: ${color}">${value || 'æœªè¨­å®š'}</span></div>`;
            }
            html += '</div>';
            
            // ãƒ•ã‚¡ã‚¤ãƒ«ãƒã‚§ãƒƒã‚¯
            html += '<h3 style="color: #667eea; margin-bottom: 10px;">ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«ãƒã‚§ãƒƒã‚¯</h3>';
            html += '<div style="margin-bottom: 20px;">';
            for (const [key, value] of Object.entries(data.file_checks)) {
                const color = value.includes('âœ…') ? '#28a745' : '#dc3545';
                html += `<div style="padding: 5px; background: #f8f9fa; border-radius: 5px; margin-bottom: 5px;"><strong>${key}:</strong> <span style="color: ${color}">${value}</span></div>`;
            }
            html += '</div>';
            
            // ã‚µãƒ¼ãƒ“ã‚¹çŠ¶æ…‹
            html += '<h3 style="color: #667eea; margin-bottom: 10px;">âš™ï¸ ã‚µãƒ¼ãƒ“ã‚¹çŠ¶æ…‹</h3>';
            html += '<div style="margin-bottom: 20px;">';
            for (const [key, value] of Object.entries(data.services_status)) {
                const color = value ? '#28a745' : '#dc3545';
                const status = value ? 'âœ… å‹•ä½œä¸­' : 'âŒ åœæ­¢';
                html += `<div style="padding: 5px; background: #f8f9fa; border-radius: 5px; margin-bottom: 5px;"><strong>${key}:</strong> <span style="color: ${color}">${status}</span></div>`;
            }
            html += '</div>';
            
            // ãƒ‡ãƒ¼ã‚¿å¯ç”¨æ€§
            html += '<h3 style="color: #667eea; margin-bottom: 10px;">ğŸ“Š ãƒ‡ãƒ¼ã‚¿å¯ç”¨æ€§</h3>';
            html += '<div style="margin-bottom: 20px;">';
            const diagnosticColor = data.diagnostic_data_available ? '#28a745' : '#dc3545';
            const repairColor = data.repair_cases_available ? '#28a745' : '#dc3545';
            html += `<div style="padding: 5px; background: #f8f9fa; border-radius: 5px; margin-bottom: 5px;"><strong>è¨ºæ–­ãƒ‡ãƒ¼ã‚¿:</strong> <span style="color: ${diagnosticColor}">${data.diagnostic_data_available ? 'âœ… åˆ©ç”¨å¯èƒ½' : 'âŒ åˆ©ç”¨ä¸å¯'}</span></div>`;
            html += `<div style="padding: 5px; background: #f8f9fa; border-radius: 5px; margin-bottom: 5px;"><strong>ä¿®ç†ã‚±ãƒ¼ã‚¹:</strong> <span style="color: ${repairColor}">${data.repair_cases_available ? 'âœ… åˆ©ç”¨å¯èƒ½' : 'âŒ åˆ©ç”¨ä¸å¯'}</span></div>`;
            html += '</div>';
            
            html += '</div>';
            debugContent.innerHTML = html;
        }

        // ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰ã®åˆ‡ã‚Šæ›¿ãˆï¼ˆéè¡¨ç¤ºï¼‰
        function toggleDebug() {
            // debugMode = !debugMode;
            // const debugPanel = document.getElementById('debugPanel');
            // debugPanel.classList.toggle('show');
            
            // if (debugMode) {
            //     fetchDebugInfo();
            // }
        }
    </script>
</body>
</html>
